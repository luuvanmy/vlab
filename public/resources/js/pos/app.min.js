"use strict";function AppTableOrders(t){if($(t).length){window.localStorage;var e={groups:$(t).data("groups"),sources:$(t).data("sources"),categories:$(t).data("categories"),warehouses:$(t).data("warehouses"),products:$(t).data("products"),provinces:$(t).data("provinces"),ProductName:{},user:$(t).data("user"),DefaultWarehouse:$(t).data("warehouse-id"),bartender:$(t).data("bartender"),users:$(t).data("users"),setting:$(t).data("setting"),listUsers:{}};e.groups=e.groups.map(function(t){return{_id:t._id,name:t.name}}),e.warehouses=e.warehouses.map(function(t){return{_id:t._id,name:t.name}}),e.provinces=e.provinces.map(function(t){var n=e.DefaultWarehouse;return{_id:t._id,name:t.name,districts:t.districts.map(function(t){var e=0;return t.hasOwnProperty("price_warehouses")&&t.price_warehouses.hasOwnProperty(n)&&(e=t.price_warehouses[n].price_default),{_id:t._id,name:t.name,fee:e}})}});var n={};e.users.forEach(function(t){n[t._id]=t.name}),e.user={_id:e.user._id,name:e.user.name,type_pos:e.user.type_pos},e.categories=e.categories.map(function(t){return{_id:t._id,name:t.name}}),Vue.filter("username",function(t){return n.hasOwnProperty(t)?n[t]:""});return new Vue({el:t,data:{defaultData:e,loader:!1,warehouse_id:e.DefaultWarehouse,groups:e.groups,categories:e.categories,products:e.products,warehouses:e.warehouses,sources:e.sources,ProductNames:e.ProductName,provinces:e.provinces,user:e.user,users:n,listUsersOnline:[],createGroup:null,createTable:null,switchTable:null,joinTable:null,group:"all",config:{tab:"table",group:"all",category:"all",keywordSource:"",keywordProduct:"",keywordCustomer:"",tableView:"grid",productView:"grid",productState:"all",state:"all",activeTable:"",activeIndexTable:-1,loadingTabProduct:!1,loadingAddProduct:!1,isFullScreen:!1,showPayment:!1,userType:e.user.type_pos,chooseNumber:e.setting.allow_import_quantity,allowOpen:e.setting.open_menu,autoHideProduct:e.setting.auto_hide_product,use_takeaway:e.setting.allow_takeaway,use_bartender:e.setting.notify_chief,use_booked:e.setting.allow_book,allow_print:e.setting.allow_print,time_book_notify:e.setting.time_book_notify,allow_ringtone:!0,allSetting:e.setting},customers:[],detail:null,loading:{update:!1,table:!1,customer:!1,remove:!1},payment:null,schedule:{},chiefs:[],order:!1,setting:!1,logs:!1,images:{},audio:null},methods:{sound:function(){},getTime:function(){return parseInt((new Date).getTime()/1e3)},changeView:function(t){this.config.view!=t&&(this.config.view=t)},changeTab:function(t){if(this.config.tab!=t)switch(t){case"wait":this.getListSuccessChief();break;default:this.config.tab=t}},addProduct:function(t,e){var n=this;if(""!=n.config.activeTable)if(1==t.manage_inventory&&t.available_quantity<=0)helper.dialog("Sản phẩm hết hàng !","warning","warning",1e3);else{var i=_.findIndex(n.sources,{_id:n.config.activeTable});-1!=i&&$.post("/admin/sales/pos/postAddProductToTable",{source_id:n.sources[tableIndex]._id,product_id:t._id,quantity:e},function(t){if(403!=t.status&&0==t.error){var e=_.findIndex(n.sources[i].products,{_id:t.data._id});e>=0?n.$set(n.sources[i].products,e,t.data):n.sources[i].products.push(t.data)}}).fail(function(){}).always(function(){})}else helper.dialog("Chưa chọn bàn !","warning","warning",1e3)},removeProduct:function(t,e){var n=this;n.loading.remove=!0,n.showLoader();var i=_.findIndex(n.sources,{_id:n.config.activeTable});-1!=i&&$.post("/admin/sales/pos/postRemoveProductFromTable",{source_id:n.config.activeTable,product_id:t,quantity:e},function(t){if(403!=t.status&&0==t.error){t.data;var e=_.findIndex(n.sources[i].products,{_id:t.data._id});if(e>=0&&(n.sources[i].products[e].updated_at=t.data.updated_at,n.sources[i].products[e].request_quantity=t.data.request_quantity),socket.emit("pos_user_alert_to_chief",{user:n.user,data:t.data_chief.data}),t.hasOwnProperty("inventory")){for(var s=0;s<n.data.length;s++){var a=n.data[s]._id;t.inventory.hasOwnProperty(a)&&(n.data[s].available_quantity=t.inventory[a])}socket.emit("pos_user_update_product_quantity",t.inventory)}}}).fail(function(){}).always(function(){n.closeLoader(),n.loading.remove=!1})},onChooseProduct:function(t){var e=this;""!=e.config.activeTable?1==t.manage_inventory&&t.available_quantity<=0?helper.dialog("Sản phẩm hết hàng !","warning","warning",1e3):e.config.chooseNumber?e.$refs.keyboard.show(1,function(n){n>=0&&e.addProduct(t,n)}):e.addProduct(t,1):helper.dialog("Chưa chọn bàn !","warning","warning",1e3)},getListSuccessChief:function(){var t=this;t.loader||(t.loader=!0,$.get("/admin/sales/pos/getSuccessChief",function(e){0==e.error&&(t.chiefs=e.data,t.config.tab="wait")}).fail(function(){}).always(function(){t.loader=!1}))},showModalSwitchTable:function(t,e){var n=this,i=_.find(this.sources,{_id:t}),s=_.filter(this.sources,function(e){var n=!0;return"empty"!=e.state&&""!=e.state&&(n=!1),e._id!=t&&n}),a=!0,o=null,c=$.confirm({title:"Chuyển bàn "+i.name,content:'\n                        <form id="form-switch-table" @submit.stop.prevent="onSubmit">\n                            <div class="form-group mg-bottom-10">\n                                <label>Chọn bàn chuyển đến</label>\n                                <select2 name="target" required placeholder="Chọn bàn muốn chuyển đến" :options="source" v-model="target" class="form-control"> </select2>\n                            </div>\n                        </form>\n                    ',type:"green",backgroundDismiss:function(){return"backdrop"},buttons:{backdrop:{isHidden:!0,action:function(){return a}},save:{text:"Xác nhận",btnClass:"btn-success",action:function(){var e=o.target;return""==e?($.dialog("Chưa chọn bàn chuyển đến !"),!1):(a=!1,c.showLoading(!0),new Promise(function(i,s){$.post("/admin/sales/pos/postTransferSaleSource",{id_source:t,id_target:e},function(s){if(console.log(s),403!=s.status)if(0==s.error){i(!0);var a=s.data.target;n.config.activeTable==t&&(n.config.activeTable=e);var o=[];a.hasOwnProperty("relation")&&_.isArray(a.relation)&&a.relation.forEach(function(t){o.push(t._id)}),n.updateSource({source:a,relation:o,replace:s.data.source}),$(n.$refs.modalSwitchTable).modal("hide"),helper.dialog(s.message,"check","success",1e3)}else helper.dialog(s.message,"warning","warning",1e3)}).fail(function(){}).always(function(){})}))}},close:{text:"Đóng",btnClass:"btn-default"}},onOpenBefore:function(){c.showLoading()},onContentReady:function(){o=new Vue({el:"#form-switch-table",data:{target:"",source:s},methods:{onSubmit:function(){c.$$save.trigger("click")}},mounted:function(){c.hideLoading()}})}})},showModalJoinTable:function(t){var e=this,n=_.find(this.sources,{_id:t});if(void 0!=n){var i=[];n.hasOwnProperty("relation")&&""!=n.relation&&null!=n.relation&&(i=n.relation.map(function(t){return t._id}));var s=_.filter(this.sources,function(e){var n=!0;return"empty"!=e.state&&""!=e.state&&(n=!1),i.indexOf(e._id)>=0&&(n=!0),e._id!=t&&n}),a=!0,o=null,c=$.confirm({title:"Chuyển bàn "+n.name,content:'\n                        <form id="form-switch-table" @submit.stop.prevent="onSubmit">\n                            <div class="form-group mg-bottom-10">\n                                <label>Chọn bàn cần gộp </label>\n                                <select2 :multiple="true" name="relation"  placeholder="Chọn bàn gộp" :options="tables"\n                            v-model="relation" class="form-control"> </select2>\n                            </div>\n                        </form>\n                    ',type:"green",backgroundDismiss:function(){return"backdrop"},buttons:{backdrop:{isHidden:!0,action:function(){return a}},save:{text:"Xác nhận",btnClass:"btn-success",action:function(){var n=o.relation;return a=!1,c.showLoading(!0),new Promise(function(i,s){$.post("/admin/sales/pos/postMergeSaleSource",{id_source:t,id_target:n},function(t){if(403!=t.status)if(0==t.error){i(!0);var n=t.data.target.map(function(t){return t._id});e.updateSource({source:t.data.source,relation:n,unrelation:t.data.unrelation}),$(e.$refs.modalJoinTable).modal("hide"),helper.dialog(t.message,"check","success",1e3)}else helper.dialog(t.message,"warning","warning",1e3)}).fail(function(){}).always(function(){})})}},close:{text:"Đóng",btnClass:"btn-default"}},onOpenBefore:function(){c.showLoading()},onContentReady:function(){o=new Vue({el:"#form-switch-table",data:{tables:s,relation:i},methods:{onSubmit:function(){c.$$save.trigger("click")}},mounted:function(){c.hideLoading()}})}})}},showModalConfig:function(){this.setting=!0},clearTable:function(t){var e=this;e.comfirm("Thông báo !","Xác nhận hủy bàn  ?",{save:{text:"Xác nhận",btnClass:"btn-success",keys:["enter"],action:function(){e.showLoader(),$.post("/admin/sales/pos/postCancelTable",{_id:t},function(n){if(403!=n.status)if(0==n.error){e.config.tab="table",e.config.activeTable="";var i={source:n.data,unrelation:n.unrelation,clear:t};n.hasOwnProperty("inventory")&&(i.update_product_quantity=n.inventory),e.updateSource(i),helper.dialog(n.message,"check","success",1e3)}else helper.dialog(n.message,"warning","warning",1e3)}).fail(function(){}).always(function(){e.closeLoader()})}},close:{text:"Đóng",btnClass:"btn-default",keys:["esc"]}})},comfirm:function(t,e,n){$.confirm({title:void 0==t?"":t,content:void 0==e?"":e,buttons:n})},fullScreen:function(){document.fullScreenElement&&null!==document.fullScreenElement||!document.mozFullScreen&&!document.webkitIsFullScreen?(document.documentElement.requestFullScreen?document.documentElement.requestFullScreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullScreen&&document.documentElement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT),this.config.isFullScreen=!0):(document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen(),this.config.isFullScreen=!1)},showLoader:function(){this.loader=!0},closeLoader:function(t,e){void 0==t&&(t=500);var n=this;setTimeout(function(){n.loader=!1,"function"==typeof e&&e()},t)},updateProductQuantity:function(t){for(var e=0;e<this.products.length;e++){var n=this.products[e]._id;t.hasOwnProperty(n)&&(this.products[e].available_quantity=t[n])}},updateSource:function(t){var e=this;if(void 0!=t&&t.hasOwnProperty("source")){var n=t.source,i=[],s=[];t.hasOwnProperty("relation")&&(i=t.relation),t.hasOwnProperty("unrelation")&&(s=t.unrelation);var a={},o=_.findIndex(this.sources,{_id:n._id});if(o>=0&&this.$set(this.sources,o,n),a.source=n,_.isArray(i)&&i.length&&(i.forEach(function(t){var i=_.findIndex(e.sources,{_id:t});i>=0&&(e.$set(e.sources[i],"current_user",n.current_user),e.$set(e.sources[i],"state","booked"),e.$set(e.sources[i],"relation_id",n._id))}),a.relation=i),_.isArray(s)&&s.length&&(s.forEach(function(t){var n=_.findIndex(e.sources,{_id:t});n>=0&&(e.$set(e.sources[n],"current_user",""),e.$set(e.sources[n],"state","empty"),e.$set(e.sources[n],"relation_id",""))}),a.unrelation=s),t.hasOwnProperty("replace"))(c=_.findIndex(this.sources,{_id:t.replace._id}))>=0&&this.$set(this.sources,c,t.replace),a.replace=t.replace;if(t.hasOwnProperty("update_product_quantity")){a.update_product_quantity=t.update_product_quantity;for(var c=0;c<this.products.length;c++){var l=this.products[c]._id;t.update_product_quantity.hasOwnProperty(l)&&(this.products[c].available_quantity=t.update_product_quantity[l],this.products[c].onhand_quantity=t.update_product_quantity[l])}}t.hasOwnProperty("clear")&&(a.clear=t.clear),t.hasOwnProperty("payment")&&(a.payment=t.payment),socket.emit("pos_user_update_table",a)}},updateProductInSource:function(t){var e=_.findIndex(this.sources,{_id:t.source_id});if(e>=0){var n=_.findIndex(this.sources[e].products,{_id:t._id});n>=0&&(this.$set(this.sources[e].products,n,t),socket.emit("pos_user_update_table",{source:this.sources[e]}))}},createCustomer:function(t){var e=!0,n=null,i=$.confirm({title:"Tạo mới khách hàng",content:'\n                        <form id="form-create-customer" @submit.stop.prevent="onSubmit">\n                            <div class="form-group mg-bottom-10">\n                                <label>Tên khách hàng</label>\n                                <input v-model="name"  type="text" class="form-control" placeholder="Nhập tên khách hàng " />\n                            </div>\n                            <div class="form-group mg-bottom-10">\n                                <label>Số điện thoại</label>\n                                <input v-model="phone"  type="tel" class="form-control" placeholder="Nhập số điện thoại" />\n                            </div>\n                        </form>\n                    ',type:"green",backgroundDismiss:function(){return"backdrop"},buttons:{backdrop:{isHidden:!0,action:function(){return e}},save:{text:"Xác nhận",btnClass:"btn-success",action:function(){var s=n.name,a=n.phone;return""==s?($.dialog("Chưa nhập tên khách hàng !"),!1):""==a?($.dialog("Chưa nhập số điện thoại !"),!1):(e=!1,i.showLoading(!0),new Promise(function(e,n){$.post("/admin/sales/pos/postCreateCustomer",{name:s,phone:a},function(n){403!=n.status&&(0==n.error?("function"==typeof t&&t(n.data),e(!0),helper.dialog(n.message,"check","success",1e3)):helper.dialog(n.message,"warning","warning",1e3))}).fail(function(){}).always(function(){})}))}},close:{text:"Đóng",btnClass:"btn-default"}},onOpenBefore:function(){i.showLoading()},onContentReady:function(){n=new Vue({el:"#form-create-customer",data:{name:"",phone:""},methods:{onSubmit:function(){i.$$save.trigger("click")}},mounted:function(){i.hideLoading()}})}})},activeItemProduct:function(t,e){var n=this.$refs.SourceDetail;if(void 0!=n){var i="#"+t;if($(".detail_source_product").not($(i)).removeClass("is-active"),$(i).addClass("is-active"),1==e){var s=n.$refs.list;void 0!=s&&$(s).scrollToElement(i,500)}}},initKeyCode:function(){var t=this;$(document).unbind("keydown").bind("keydown",function(e){var n=e.keyCode?e.keyCode:e.which;switch(console.log(n),n){case 13:console.log("enter");var i=t.$refs.modal_payment;void 0!=i&&i.send();break;case 112:e.preventDefault(),e.stopPropagation(),console.log("F1");break;case 113:e.preventDefault(),e.stopPropagation(),console.log("F2"),t.changeTab("table");break;case 114:e.preventDefault(),e.stopPropagation(),console.log("F3"),t.changeTab("products");break;case 115:e.preventDefault(),e.stopPropagation(),console.log("F4"),t.changeTab("wait");break;case 117:e.preventDefault(),e.stopPropagation(),console.log("F6"),t.changeTab("booked");break;case 118:e.preventDefault(),e.stopPropagation(),console.log("F7"),t.changeTab("order");break;case 119:if(e.preventDefault(),e.stopPropagation(),console.log("F8"),void 0!=(a=t.$refs.SourceDetail)){var s=a.$refs.inputCustomer;console.log(s),void 0!=s&&s.setFocus()}break;case 120:e.preventDefault(),e.stopPropagation(),console.log("F9"),void 0!=(a=t.$refs.SourceDetail)&&a._notifications();break;case 121:var a;e.preventDefault(),e.stopPropagation(),console.log("F10"),void 0!=(a=t.$refs.SourceDetail)&&a._showPayment()}})}},computed:{},watch:{"config.activeTable":function(t){this.config.activeIndexTable=""!=t?_.findIndex(this.sources,{_id:t}):-1}},created:function(){this.images={table:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAeCAYAAABe3VzdAAAACXBIWXMAAAsTAAALEwEAmpwYAAAF8GlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo2ZGE4MmIxMi0zZDhiLTkwNGUtOGQ5NC1mNWExYzBiNTZmZDUiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OTk3RjY2OUFDMTQ4MTFFODlBMTdEMTkzMkIzMTlBMUEiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MDk2ZjdiZTctZTljNi01NTQyLWIxNWItYTI4YTEwNDg1YjE4IiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDE4LTA5LTI2VDExOjU2OjU5KzA3OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOC0wOS0yNlQxMTo1OTo1OSswNzowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOC0wOS0yNlQxMTo1OTo1OSswNzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjEzNzVmZWNlLWNjMTEtYjg0MC04MDllLWRkMjBkMDM5OTZmYiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo2ZGE4MmIxMi0zZDhiLTkwNGUtOGQ5NC1mNWExYzBiNTZmZDUiLz4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MDk2ZjdiZTctZTljNi01NTQyLWIxNWItYTI4YTEwNDg1YjE4IiBzdEV2dDp3aGVuPSIyMDE4LTA5LTI2VDExOjU5OjU5KzA3OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pji//kwAAAEYSURBVFiF7ZWxSgNBEIa/EwmoTTwhRQQJmCoPk2aew0p8CkmlrzGND5PKQBC0EAx2Qpq1uF2Uc+9uj73gFvs1uxzD/h+7x0xhjCFljv5boIssGEsWjCV5weP6BxF5BcbAHjDACCgOkG1sRmEzPlX1slMQmNr19ABSdc5+7b15PsElcAI8ABPgFtgObQbMgBXwDtwAX76ioj5JRMRtn4Fr4ALYhaaqalCdiJTAB7BR1XlTXZPgCFhbwac+gj0oqV5rAyxUde8r8j2xw5kvBxZryvHSJuha0D3wNpjOD1Pgjo5W1yboWssj8BKa2uMfvKISbG1hIY36PCixP0HnJj9JsmAsWTCWLBjLn1mcGsnfYBaMJQvGkrzgN8iBNj3ZMh1GAAAAAElFTkSuQmCC",square:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAMAAAAoyzS7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQyIDc5LjE2MDkyNCwgMjAxNy8wNy8xMy0wMTowNjozOSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo2Qzc1QTQ0QkU0OTIxMUU4OUEwRkY1RkE1ODA1QzQwNCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo2Qzc1QTQ0Q0U0OTIxMUU4OUEwRkY1RkE1ODA1QzQwNCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjZDNzVBNDQ5RTQ5MjExRTg5QTBGRjVGQTU4MDVDNDA0IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjZDNzVBNDRBRTQ5MjExRTg5QTBGRjVGQTU4MDVDNDA0Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+ufrPzAAAAAZQTFRF////AAAAVcLTfgAAAAF0Uk5TAEDm2GYAAAAMSURBVHjaYmAACDAAAAIAAU9tWeEAAAAASUVORK5CYII="}},mounted:function(){var t=this;this.initKeyCode(),$(this.$refs.sound).trigger("load"),$(t.$refs.modalProductNote).on("hidden.bs.modal",function(){t.ProductNote=null}),$(t.$refs.modalProductNote).on("shown.bs.modal",function(){$(t.$refs.ProductNoteInput).focus()}),$(t.$refs.modalPayment).on("hidden.bs.modal",function(){t.payment=null}),$(t.$refs.modalCalc).modal("show"),setTimeout(function(){$(".page-loader").fadeOut(function(){$(this).remove()})},1e3);var e=$("#app").data("user"),n=$("#app").data("host");socket.emit("pos_user_connected",{hostname:n,user_id:e._id,user_name:e.name,type:"cashier"}),socket.on("reconnect_func",function(){socket.on("pos_connect",function(){socket.emit("pos_user_connected",{hostname:n,user_id:e._id,user_name:e.name,type:"cashier"})})}),socket.on("pos_on_admin_update_config",function(){$.confirm({title:"Thông báo",content:"Quản lý vừa cập nhật hệ thông !",type:"orange",buttons:{save:{text:"Tải lại trang",btnClass:"btn-success"}},onClose:function(){window.location.reload()}})}),socket.on("pos_user_connect_room",function(t){console.log(t.email+" connected")}),socket.on("post_user_disconnect",function(t){console.log(t.email+" disconnected")}),socket.on("pos_on_update_table",function(e){(e.hasOwnProperty("relation")&&e.relation.length&&e.relation.forEach(function(n){var i=_.findIndex(t.sources,{_id:n});i>=0&&(t.sources[i].current_user=e.source.current_user,t.sources[i].relation_id=e.source._id,t.sources[i].state="booked"),t.config.activeTable==n&&(t.config.activeTable="")}),e.hasOwnProperty("unrelation")&&e.unrelation.length&&e.unrelation.forEach(function(e){var n=_.findIndex(t.sources,{_id:e});n>=0&&(t.sources[n].current_user="",t.sources[n].relation_id="",t.sources[n].state="empty"),t.config.activeTable==e&&(t.config.activeTable="")}),e.hasOwnProperty("replace"))&&((n=_.findIndex(t.sources,{_id:e.replace._id}))>=0&&Vue.set(t.sources,n,e.replace),e.source.hasOwnProperty("relation")&&e.source.relation.length&&e.source.relation.forEach(function(n){var i=_.findIndex(t.sources,{_id:n._id});i>=0&&(t.sources[i].relation_id=e.source._id)}),t.config.activeTable==e.replace._id&&(t.config.activeTable=""));if(e.source.hasOwnProperty("_id")){var n;if((n=_.findIndex(t.sources,{_id:e.source._id}))>=0&&Vue.set(t.sources,n,e.source),"booked"==e.source.state||null!=e.source.relation_id&&""!=e.source.relation_id)if("booked"==t.config.tab)if(1==t.$refs.tab_booking.confirm.show)(n=_.findIndex(t.$refs.tab_booking.confirm.selected,{_id:e.source._id}))>=0&&($.dialog(e.source.name+" đã có khách vào !"),t.$refs.tab_booking.confirm.selected.splice(n,1));e.hasOwnProperty("clear")&&t.config.activeTable==e.clear&&(t.config.activeTable="",$.dialog(e.source.name+" đã bị hủy bởi quản lý !"))}}),socket.on("pos_user_online",function(e){var n=[];for(var i in e)e.hasOwnProperty(i)&&"cashier"==e[i].type&&n.push(e[i].user_id);t.listUsersOnline=n}),socket.on("pos_on_send_success",function(e){if("wait"==t.config.tab){var n=_.findIndex(t.chiefs,{_id:e.data._id});n>=0?t.$set(t.chiefs,n,e.data):t.chiefs.push(e.data)}}),socket.on("pos_on_update_product_quantity",function(e){for(var n=0;n<t.products.length;n++){var i=t.products[n]._id;e.hasOwnProperty(i)&&(t.products[n].available_quantity=e[i])}}),socket.on("pos_on_notification",function(e){t.user._id==e.user_id&&(t.sound(),$.notify({icon:"notifications_active",message:e.message},{type:"info",timer:5e3,delay:500,dismissonclick:!0,newest_on_top:!1,placement:{from:"bottom",align:"right"},offset:70,animate:{enter:"animated fadeInDown",exit:"animated fadeOutRight"}}))}),socket.on("pos_on_payment_success",function(e){if(e.hasOwnProperty("source")){var n=_.findIndex(t.sources,{_id:e.source._id});n>=0&&Vue.set(t.sources,n,e.source)}e.hasOwnProperty("unrelation")&&e.unrelation.length&&e.unrelation.forEach(function(e){var n=_.findIndex(t.sources,{_id:e});n>=0&&(t.sources[n].current_user="",t.sources[n].relation_id="",t.sources[n].state="empty")})})}})}}Vue.component("keyboard",{template:'\n        <div class="modal fade  modal-keyboard">\n            <div class="modal-dialog" role="document">\n                <div class="modal-content" >\n                    <div class="modal-header">\n                        <div class="input-group ">\n                            <div class="input-group-btn">\n                                <button class="btn" @click.stop.prevent="_decr()"><i class="fa fa-minus"></i></button>\n                            </div>\n                            <input   class="form-control" v-model="value" @keydown.stop.prevent="_input($event)" ref="money" />\n                            <div class="input-group-btn">\n                                <button class="btn" @click.stop.prevent="_incr()"><i class="fa fa-plus"></i></button>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class="modal-body">\n                        <div class="row">\n                            <div class="col col-xs-4"><button class="btn" @click.stop.prevent="press(7)">7</button></div>\n                            <div class="col col-xs-4"><button class="btn" @click.stop.prevent="press(8)">8</button></div>\n                            <div class="col col-xs-4"><button class="btn" @click.stop.prevent="press(9)">9</button></div>\n                        </div>\n                        <div class="row">\n                            <div class="col col-xs-4"><button class="btn" @click.stop.prevent="press(4)">4</button></div>\n                            <div class="col col-xs-4"><button class="btn" @click.stop.prevent="press(5)">5</button></div>\n                            <div class="col col-xs-4"><button class="btn" @click.stop.prevent="press(6)">6</button></div>\n                        </div>\n                        <div class="row">\n                            <div class="col col-xs-4"><button class="btn" @click.stop.prevent="press(1)">1</button></div>\n                            <div class="col col-xs-4"><button class="btn" @click.stop.prevent="press(2)">2</button></div>\n                            <div class="col col-xs-4"><button class="btn" @click.stop.prevent="press(3)">3</button></div>\n                        </div>\n                        <div class="row">\n                            <div class="col col-xs-4"><button class="btn btn-small" @click.stop.prevent="selected()">Chọn</button></div>\n                            <div class="col col-xs-4"><button class="btn " @click.stop.prevent="press(0)">0</button></div>\n                            <div class="col col-xs-4"><button class="btn btn-small" @click.stop.prevent="remove()">Xóa</button></div>\n                        </div>\n                    </div>\n                    <div class="modal-footer">\n                        <div class="row">\n                            <div class="col col-xs-6">\n                                <button type="button" class="btn btn-default" data-dismiss="modal">Đóng (Esc)</button>\n                            </div>\n                            <div class="col col-xs-6">\n                                <button type="submit" class="btn btn-success" @click.stop.prevent="onSave()">Xong (Enter)</button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    ',data:function(){return{value:"",callback:null,onClose:null,max:999999999,keycodes:{96:0,97:1,98:2,99:3,100:4,101:5,102:6,103:7,104:8,105:9,48:0,49:1,50:2,51:3,52:4,53:5,54:6,55:7,56:8,57:9}}},methods:{_incr:function(){var t=parseInt(this.unFormatMoney(this.value));t>=this.max?t=this.max:t++,this.value=this.formatMoney(t),this.$nextTick(function(){$(this.$refs.money).focus().setCursorPosition(this.value.length)})},_decr:function(){var t=parseInt(this.unFormatMoney(this.value));t>0&&(t--,this.value=this.formatMoney(t)),this.$nextTick(function(){$(this.$refs.money).focus().setCursorPosition(this.value.length)})},_input:function(t){t.preventDefault();var e=t.keyCode?t.keyCode:t.which;if(13!=e){if(8==e||46==e)return t.preventDefault(),t.stopPropagation(),void this.remove();if(this.keycodes.hasOwnProperty(e)){var n=this.keycodes[e];this.press(n)}}else this.onSave()},press:function(t){var e=this.$refs.money,n=this.value,i=e.selectionStart,s=e.selectionEnd,a=this.getCaret(),o=0,c=String(t);if(i==s){var l=n.substring(0,a);l=_.split(l,",").length;var r=n.substring(0,a)+c+n.substring(a,n.length);r=this.unFormatMoney(r);var d=(r=this.formatMoney(r)).substring(0,a+1);d=_.split(d,",").length,o=d>l?a+2:a+1}else{l=n.substring(0,s);l=_.split(l,",").length;r=n.substring(0,i)+c+n.substring(s,n.length);r=this.unFormatMoney(r);d=(r=this.formatMoney(r)).substring(0,i+1);d=_.split(d,",").length,o=d>l?i+2:i+1}var u=!1;this.unFormatMoney(r)>=this.max&&(r=this.formatMoney(this.max),u=!0),this.value=r,this.$nextTick(function(){u||0==o?o=r.length:","==r.substring(o-1,o)&&(o-=1);$(e).focus().setCursorPosition(o)})},remove:function(){var t=this.getCaret();console.log(t);var e=this.$refs.money,n=_.toString(this.value),i=e.selectionStart,s=e.selectionEnd,a=0;if(i==s){if(t>=0){var o=n.substring(0,t);o=_.split(o,",").length;var c=n.substring(0,t-1)+n.substring(t,n.length);c=unFormatMoney(c);var l=(c=formatMoney(c)).substring(0,t+1);l=_.split(l,",").length,a=l<o?t-2:t-1}}else if(i>=0){o=n.substring(0,s);o=_.split(o,",").length;c=n.substring(0,i)+n.substring(s,n.length);c=unFormatMoney(c);l=(c=formatMoney(c)).substring(0,i+1);l=_.split(l,",").length,a=l<o?i-2:i-1}var r=!1;this.unFormatMoney(c)>=this.max&&(c=this.formatMoney(this.max),r=!0),this.value=c,this.$nextTick(function(){r||0==a?a=c.length:","==c.substring(a-1,a)&&(a-=1);$(e).focus().setCursorPosition(a)})},onKey:function(t){var e=t.keyCode?t.keyCode:t.which;if(13==e&&this.onSave(),e>=48&&e<=57){t.preventDefault();var n=this.keycodes[e];this.press(n)}},selected:function(){this.$refs.money.select()},show:function(t,e,n,i){this.value=this.formatMoney(t),this.callback=e,this.max=void 0==n?999999999:n,console.log(i),this.onClose="function"==typeof i?i:null,$(this.$el).modal("show")},onSave:function(){"function"==typeof this.callback&&(this.callback(parseInt(this.unFormatMoney(this.value))),$(this.$el).modal("hide"))},unFormatMoney:function(t){var e=_.toString(t);return _.parseInt(e.replace(/,/g,""))},formatMoney:function(t,e){for(var n=""+Math.floor(t),i=t%1,s=n.length,a="";(s-=3)>0;)a=","+n.substr(s,3)+a;return n.substr(0,s+3)+a+(i?"."+Math.round(i*Math.pow(10,e||2)):"")},onBlur:function(){this.position={from:this.$refs.money.selectionStart,to:this.$refs.money.selectionEnd}},getCaret:function(){var t=0,e=this.$refs.money;if(document.selection){e.focus();var n=document.selection.createRange();n.moveStart("character",-e.value.length),t=n.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t},setCaret:function(t){var e=this.$refs.money;if(null!=e)if(e.createTextRange){var n=e.createTextRange();n.move("character",t),n.select()}else e.selectionStart?(e.focus(),e.setSelectionRange(t,t)):e.focus()}},mounted:function(){var t=this;$(this.$el).on("hidden.bs.modal",function(){t.value="",t.callback=null,t.max=999999999,$(document).unbind("keypress"),"function"==typeof t.onClose&&(console.log("close"),t.onClose()),$(".modal.in").length&&$("body").addClass("modal-open")}),$(this.$el).on("shown.bs.modal",function(){t.selected(),$(document).bind("keypress",function(e){e.preventDefault(),13==(e.keyCode?e.keyCode:e.which)&&(e.preventDefault(),t.onSave())})});for(var e=0;e<=9;e++){var n=48+e;this.keycodes[n]=e}this.keycodes[45]=0}}),Vue.component("tab-order",{template:'\n        <div class="table-order-container-full">\n            <div class="box-list-order" v-if="loader">\n                <div class="box-loading" >\n                    <svg class="circular" viewBox="25 25 50 50">\n                        <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10" />\n                    </svg>\n                </div>\n            </div>\n            <transition name="fade">\n                <div class="box-list-order" v-if="!loader">\n                    <div class="box-list-order-header">\n                        <div class="inline-block inline-title">\n                            <p>Tìm thấy <strong>{{pagination.total_records}}</strong> đơn hàng theo yêu cầu .</p>\n                        </div>\n                        <div class="inline-block inline-search">\n                            <div class="form-search">\n                                <input type="text" v-model.trim="pagination.keyword" placeholder="Nhập từ khóa cần tìm ..." class="form-control" />\n                            </div>\n                        </div>\n                        <div class="inline-block inline-daterange">\n                            <daterange-picker v-model="pagination.range"></daterange-picker>\n                        </div>\n                        <div class="inline-block inline-status">\n                            <div class="btn-group" role="group" aria-label="...">\n                                <button @click.stop.prevent="pagination.status = \'publish\' " :class="{\'btn-primary\' : pagination.status ==\'publish\'}" class="btn btn-default">\n                                    <i class="fas fa-eye"></i>\n                                </button>\n                                <button @click.stop.prevent="pagination.status = \'disable\' " :class="{\'btn-primary\' : pagination.status ==\'disable\'}" class="btn btn-default">\n                                    <i class="fas fa-trash-alt"></i>\n                                </button>\n                            </div>\n                        </div>\n                        \n                        \n                    </div>\n                    <div class="box-list-order-body ">\n                        <div class="table table-orders">\n                            <div class="table-head">\n                                <div class="row">\n                                    <div class="col index">#</div>\n                                    <div class="col center">\n                                        <div class="col code">Mã hóa đơn</div>\n                                        <div class="col created">Ngày tạo</div>\n                                        <div class="col source">Khu vực/ bàn</div>\n                                        <div class="col customer">Khách hàng</div>\n                                        <div class="col user">Nhân viên</div>\n                                        <div class="col total">Tổng tiền</div>\n                                    </div>\n                                    <div class="col actions">Tác vụ</div>\n                                </div>\n                            </div>\n                            <div class="table-body" >\n                                \n                                <template v-if="pagination.loading">\n                                    <div class="box-loading" style="height:300px">\n                                        <svg class="circular" viewBox="25 25 50 50">\n                                            <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10" />\n                                        </svg>\n                                    </div>\n                                </template>\n                                <template v-else>\n                                    <template v-if="pagination.data.length">\n                                        <div class="row" v-for="(item , index) in pagination.data">\n                                            <div class="col index">{{(pagination.limit * (pagination.page - 1)) + index + 1}}</div>\n                                            <div class="col center">\n                                                <div class="col code">{{item.code}}</div>\n                                                <div class="col created">{{item.created_at | full-time}}</div>\n                                                <div class="col source">\n                                                    <template v-if="item.source == null">\n                                                        ---\n                                                    </template>\n                                                    <template v-else>\n                                                        <span v-if="_.has(item , \'source.group.name\')">{{item.source.group.name}}</span> / <span v-if="_.has(item , \'source.name\')">{{item.source.name}}</span> \n                                                    </template>\n                                                </div>\n                                                <div class="col customer">\n                                                    <template v-if="_.has(item , \'customer.name\')">{{item.customer.name}}</template>\n                                                    <template v-else> --- </template>\n                                                </div>\n                                                <div class="col user">\n                                                    <template v-if="_.has(item , \'user.name\')">{{item.user.name}}</template>\n                                                    <template v-else> --- </template>\n                                                </div>\n                                                <div class="col total">{{item.total_must_payment | money}}</div>\n                                            </div>\n                                            <div class="col actions">\n                                                <a  target="_blank" :href="\'/admin/sales/saleorder/getEditOrder?_id=\'+ item._id">\n                                                    <i class="material-icons text-primary" >info</i>\n                                                </a>\n                                                <a  @click="_remove(item)" v-if="pagination.status == \'publish\'">\n                                                    <i class="material-icons text-danger" >delete</i>\n                                                </a>\n                                                <a  @click="_restore(item)" v-else>\n                                                    <i class="material-icons text-success" >restore</i>\n                                                </a>\n                                                <a  @click="_print(item)" >\n                                                    <i class="material-icons text-warning" >print</i>\n                                                </a>\n                                            </div>\n                                        </div>\n                                    </template>\n                                    <template v-else>\n                                        <h3 class="text-center pd-30 text-danger no-mg">Không tìm thấy dữ liệu</h3>\n                                    </template>\n                                </template>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="box-list-order-footer">\n                        <div class="row">\n                            <div class="col-xs-6">\n                                <div class="inline-block inline-limit">\n                                    <select2 :options="limits" v-model="pagination.limit"></select2>\n                                </div>\n                            </div>\n                            <div class="col-xs-6">\n                                <div class="text-right">\n                                    <pagination :total="pagination.total" :current="pagination.page" :change="_changePage"></pagination>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </transition>\n            \n        </div>\n    ',props:{options:{required:!0}},data:function(){return{loader:!0,limits:[{id:10,text:10},{id:20,text:20},{id:30,text:30},{id:50,text:50},{id:100,text:100}],pagination:{limit:10,page:1,type:"all",data:[],total:0,total_records:0,loading:!1,status:"publish",range:{startDate:parseInt(moment().startOf("day").valueOf()/1e3),endDate:parseInt(moment().endOf("day").valueOf()/1e3)},keyword:"",isAdmin:"manager"==this.options.userType},timeout:null}},methods:{_load:function(){var t=this;if(!this.pagination.loading){this.pagination.loading=!0;var e={type:this.pagination.type,limit:this.pagination.limit,page:this.pagination.page,isAdmin:this.pagination.isAdmin,keyword:this.pagination.keyword,status:this.pagination.status};this.pagination.range.hasOwnProperty("startDate")&&this.pagination.range.hasOwnProperty("endDate")&&_.isDate(new Date(1e3*this.pagination.range.startDate))&&_.isDate(new Date(1e3*this.pagination.range.endDate))&&(e.startDate=this.pagination.range.startDate,e.endDate=this.pagination.range.endDate),$.post("/admin/sales/pos/postLoadSaleOrder",e,function(e){0==e.error&&(t.pagination.data=e.sale_orders,t.pagination.limit!=e.limit&&(t.pagination.limit=e.limit),t.pagination.page=e.page,t.pagination.total=e.total,t.pagination.total_records=e.total_records)}).fail(function(){}).always(function(){t.pagination.loading=!1,t.loader&&setTimeout(function(){t.loader=!1},1e3)})}},_changePage:function(t){this.pagination.page=t,this._load()},_print:function(t){$.post("/admin/sales/saleorder/getPrintOrder",{_id:t._id,name:_.has(t,"source.name")?t.source.name:"",note:t.note,mode:"create"},function(t){var e=document.getElementById("iframe");e.contentDocument.open(),e.contentDocument.writeln(t),e.contentDocument.close(),setTimeout(function(){e.contentWindow.print(),e.contentWindow.close()},500)}).fail(function(){}).always(function(){})},_info:function(t){window.location.href="/admin/sales/saleorder/getEditOrder?_id="+t._id},_newtab:function(t){console.log(t)},_restore:function(t){var e=this;$.confirm({title:"Thông báo ",content:"Bạn có muốn khôi phục hóa đơn này ?",buttons:{oke:{text:"Đồng ý",btnClass:"btn-success",action:function(){$.post("/admin/sales/saleorder/postPublishListOrder",{data:[t._id]},function(t){0==t.error?(e._load(),helper.dialog(t.message,"check","success",1e3)):helper.dialog(t.message,"warning","warning",1e3)}).fail(function(){}).always(function(){})}},close:{text:"Đóng",btnClass:"btn-default"}}})},_remove:function(t){var e=this;$.confirm({title:"Thông báo ",content:"Bạn có muốn xóa hóa đơn này ?",buttons:{oke:{text:"Đồng ý",btnClass:"btn-success",action:function(){$.post("/admin/sales/saleorder/postTrashListOrder",{data:[t._id]},function(t){0==t.error?(e._load(),helper.dialog(t.message,"check","success",1e3)):helper.dialog(t.message,"warning","warning",1e3)}).fail(function(){}).always(function(){})}},close:{text:"Đóng",btnClass:"btn-default"}}})}},computed:{},watch:{"pagination.limit":function(t){1!=this.pagination.page&&(this.pagination.page=1),this._load()},"pagination.status":function(t){1!=this.pagination.page&&(this.pagination.page=1),this._load()},"pagination.range":{handler:function(){1!=this.pagination.page&&(this.pagination.page=1),this._load()},deep:!0},"pagination.keyword":function(){var t=this;clearTimeout(this.timeout),this.timeout=setTimeout(function(){1!=t.pagination.page&&(t.pagination.page=1),t._load()},1e3)}},mounted:function(){this._load()}}),Vue.component("ComponentPayment",{template:'\n        \n            <div class="payment-wrapper">\n                <div class="payment-container" :class="{ \'is-active\' : loader }">\n                    <div class="payment-content">   \n                         <button @click="_close()" class="close" data-dismiss="modal" aria-label="Close"><i class="fal fa-times"></i></button>\n                        <div class="payment-left" >\n                            <div class="box">\n                                <div class="box-header">\n                                    <strong>{{data.name}}</strong>\n                                </div>\n                                <div class="box-body">\n                                    <div class="table table-product-on-payment">\n                                        <div class="table-head">\n                                            <div class="row">\n                                                <div class="col index">#</div>\n                                                <div class="col name">Sản phẩm</div>\n                                                <div class="col quantity">SL</div>\n                                                <div class="col price">Đơn giá</div>\n                                                <div class="col total">Thành tiền</div>\n                                            </div>\n                                        </div>\n                                        <div class="table-body" >\n                                           \n                                                <div class="row" v-for="( item , index) in data.products">\n                                                    <div class="col index">{{index + 1}}</div>\n                                                    <div class="col name">{{item.product_name}}</div>\n                                                    <div class="col quantity">{{item.request_quantity | money}}</div>\n                                                    <div class="col price">{{item.price_sale | money}}</div>\n                                                    <div class="col total">{{item.request_quantity * item.price_sale | money}}</div>\n                                                </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div class="box-footer">\n                                    <div class="item">\n                                        <div class="item-title">Tổng cộng</div>\n                                        <div class="item-value">{{sum | money}}</div>\n                                    </div>\n                                    <div class="item" v-if="data.deposit_cost > 0">\n                                        <div class="item-title">Khách thanh toán trước</div>\n                                        <div class="item-value">{{data.deposit_cost | money}}</div>\n                                    </div>\n                                    <div class="item">\n                                        <div class="item-title">Giảm giá</div>\n                                        <div class="item-value">{{data.discount_value | money}}</div>\n                                    </div>\n                                    <div class="item">\n                                        <div class="item-title">Phí giao hàng </div>\n                                        <div class="item-value">{{shippingFee | money}}</div>\n                                    </div>\n                                    <div class="item">\n                                        <div class="item-title">Thành tiền</div>\n                                        <div class="item-value">{{sum + shippingFee - data.discount_value - data.deposit_cost| money}}</div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="payment-right">\n                            <div class="box">\n                                <div class="box-header">\n                                    <strong v-once>\n                                        <template v-if=" _.has(data , \'customer.name\') ">\n                                            Khách hàng : {{data.customer.name}} - {{data.customer.phone}}\n                                        </template>\n                                    </strong>\n                                </div>\n                                <div class="box-body">\n                                    <div class="row">\n                                        <div class="col-xs-12">\n                                            <div class="form-group">\n                                                <label>\n                                                    <input type="checkbox" v-model="delivery">&nbsp;Giao hàng tận nơi</label>\n                                            </div>\n                                        </div>\n                                        <template v-if="delivery">\n                                            <vue-form :state="formstate" @submit.stop.prevent="onSubmit()">\n                                                <div class="col-xs-12">\n                                                    <validate class="form-group">\n                                                        <input name="name" required v-model="customer.name" type="text" class="form-control" placeholder="Tên khách hàng ...">\n                                                        <field-messages show="$submitted" name="name">\n                                                            <p slot="required" class="form-error">Chưa nhập tên khách hàng</p>\n                                                        </field-messages>\n                                                    </validate>\n                                                </div>\n                                                <div class="col-xs-12">\n                                                    <validate class="form-group">\n                                                        <input name="phone" required v-model="customer.phone" type="text" class="form-control" placeholder="Số điện thoại ...">\n                                                        <field-messages show="$submitted" name="phone">\n                                                            <p slot="required" class="form-error">Chưa nhập tên khách hàng</p>\n                                                        </field-messages>\n                                                    </validate>\n                                                </div>\n                                                <div class="col-xs-6">\n                                                    <validate class="form-group">\n                                                        <select2 name="province_id" required class="form-control" :label="[\'_id\' , \'name\']" :options="$root.provinces" v-model="customer.province_id" placeholder="Chọn Tỉnh/TP" :search="true"></select2>\n                                                        <field-messages show="$submitted" name="province_id">\n                                                            <p slot="required" class="form-error">Chưa nhập tên khách hàng</p>\n                                                        </field-messages>\n                                                    </validate>\n                                                </div>\n                                                <div class="col-xs-6">\n                                                    <validate class="form-group">\n                                                        <select2 name="district_id" required class="form-control" :options="districts" v-model="customer.district_id" placeholder="Chọn Quận/Huyện" :search="true"></select2>\n                                                        <field-messages show="$submitted" name="district_id">\n                                                            <p slot="required" class="form-error">Chưa nhập tên khách hàng</p>\n                                                        </field-messages>\n                                                    </validate>\n                                                </div>\n                                                <div class="col-xs-12">\n                                                    <validate class="form-group">\n                                                        <input name="address" required type="text" class="form-control" placeholder="Địa chỉ người nhận ..." v-model="customer.address">\n                                                        <field-messages show="$submitted" name="address">\n                                                            <p slot="required" class="form-error">Chưa nhập tên khách hàng</p>\n                                                        </field-messages>\n                                                    </validate>\n                                                </div>\n                                            </vue-form>\n                                        </template>\n                                    </div>\n                                    <div class="panel">\n                                        <div class="panel-body">\n                                            <div class="item">\n                                                <div class="item-title">\n                                                    Tiền khách thanh toán :\n                                                </div>\n                                                <div class="item-value">\n                                                    <strong>{{ sum + shippingFee - data.discount_value - data.deposit_cost | money}}</strong>\n                                                </div>\n                                            </div>\n                                            <div class="item">\n                                                <div class="item-title">\n                                                    Tiền khách đưa :\n                                                </div>\n                                                <div class="item-value">\n                                                    <div class="form-control" @click.stop.prevent="showAmountKeyboard()">{{amount | money}}</div>\n                                                </div>\n                                            </div>\n                                            <div class="item">\n                                                <div class="item-title">\n                                                    Tiền thừa trả khách :\n                                                </div>\n                                                <div class="item-value">\n                                                    <strong v-if="amount >= (sum + shippingFee - data.discount_value - data.deposit_cost)">{{Math.abs( amount - (sum + shippingFee - data.discount_value - data.deposit_cost) ) | money}}</strong>\n                                                    <strong v-else>Khách đưa chưa đủ</strong>\n                                                </div>\n                                            </div>\n\n                                            <ul class="list-items">\n                                                <li v-for="item in listSuggestAmount">\n                                                    <button @click.stop.prevent="onChooseAmount(item)" class="btn btn-default">{{item | money}}</button>\n                                                </li>\n                                                <li>\n                                                    <button @click.stop.prevent="showAmountKeyboard()" class="btn btn-default">Số khác</button>\n                                                </li>\n                                            </ul>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div class="box-footer">\n                                    <button class="btn btn-success btn-payment" @click.stop.prevent="send()">\n                                        Xác nhận (Enter)\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n    ',props:{data:{},options:{}},data:function(){return{formstate:{},delivery:!1,amount:0,loading:!1,sum:0,customer:{_id:"",name:"",phone:"",province_id:"",district_id:"",address:""},loader:!1}},methods:{SuggestAmount:function(t){var e=[500,1e3,2e3,5e3,1e4,2e4,5e4,1e5,2e5,5e5],n=[],i=function(t,e){for(var n=e[0],i=1;i<e.length;i++)e[i]>n&&(n=e[i]);return n},s=function(t,e){for(var n=t,s=[];n>0;){var a=i(0,e);n-=a,s.push(a)}return s.reduce(function(t,e){return t+e},0)},a=function t(i,s,a,o){if(a>o)n.push(i);else for(var c=s;c<e.length;c++)-1===i.indexOf(e[c])&&t(i.concat([e[c]]),c,a+1,o)};return function(t){var i=[],o=0;if(t>=1e7&&(o=Math.floor(t/1e7),t%=1e7),!n||0===n.length)for(var c=1;c<=10;c++)a([e[0]],0,1,c);for(c=0;c<n.length;c++){var l=s(t,n[c]);o>0&&(l=1e7*o+l),-1===i.indexOf(l)&&i.push(l)}return i.sort(function(t,e){return t>e?1:t<e?-1:0})}(t)},onChooseAmount:function(t){this.amount=t},showAmountKeyboard:function(t){var e=this,n=parseInt(e.amount);e.$root.$refs.keyboard.show(n,function(t){t!=n&&(e.amount=t)})},onSubmit:function(){},send:function(){var t=this;if(!t.loading){var e=0;t.delivery&&0==t.formstate.$submitted&&(t.formstate.$submitted=!0,e=300),setTimeout(function(){t.delivery&&!t.formstate.$valid||(t.amount<t.data.total+t.shippingFee?helper.dialog("Khách chưa đưa đủ tiền thanh toán !","warning","warning",3e3):t.sendData())},e)}},sendData:function(){var t=this;this.loading=!0;var e={source_id:this.data._id,delivery:this.delivery,discount_value:this.data.discount_value,customer:this.customer,delivery_fee:this.shippingFee};$.post("/admin/sale/pos/postPaymentSaleSource",e,function(e){if(403!=e.status)if(0==e.error){var n={source:e.source,payment:e.source._id};e.hasOwnProperty("unrelation")&&(n.unrelation=e.unrelation),t.$root.updateSource(n),t.options.tab="table",t.options.activeTable="",t.loader=!1,helper.dialog(e.message,"check","success",2e3),t.options.allow_print&&t._print({id:e.so_id,name:e.source.name,note:e.source.note})}else helper.dialog(e.message,"error","danger",4e3)}).fail(function(){}).always(function(){this.loading=!1})},_print:function(t){$.post("/admin/sales/saleorder/getPrintOrder",{_id:t.id,name:t.name,note:t.note,mode:"create"},function(t){var e=document.getElementById("iframe");e.contentDocument.open(),e.contentDocument.writeln(t),e.contentDocument.close(),setTimeout(function(){e.contentWindow.print(),e.contentWindow.close()},500)}).fail(function(){}).always(function(){})},_close:function(){this.loader=!1}},computed:{listSuggestAmount:function(){return null!=this.data?this.SuggestAmount(this.sum+this.shippingFee-this.data.discount_value-this.data.deposit_cost):[]},districts:function(){if(""!=this.customer.province_id){var t=_.find(this.$root.provinces,{_id:this.customer.province_id});if(void 0!=t)return t.districts}return[]},shippingFee:function(){if(this.delivery&&""!=this.customer.district_id&&""!=this.customer.province_id){var t=_.find(this.$root.provinces,{_id:this.customer.province_id});if(void 0!=t){var e=_.find(t.districts,{_id:this.customer.district_id});if(void 0!=e)return e.fee}}return 0}},created:function(){this.data.hasOwnProperty("deposit_cost")||this.$set(this.data,"deposit_cost",0);var t=0;this.data.products.forEach(function(e){t+=e.price_sale*e.request_quantity}),this.sum=t,this.amount=this.sum+this.shippingFee-this.data.discount_value-this.data.deposit_cost,_.has(this.data,"customer._id")&&(this.customer={_id:this.data.customer._id,name:this.data.customer.name,phone:this.data.customer.phone,province_id:this.data.customer.hasOwnProperty("province_id")?this.data.customer.province_id:"",district_id:this.data.customer.hasOwnProperty("district_id")?this.data.customer.district_id:"",address:this.data.customer.hasOwnProperty("address")?this.data.customer.address:""})},watch:{loader:function(t){var e=this;0==t&&setTimeout(function(){e.$emit("update:data",null)},300)}},mounted:function(){var t=this;$(this.$el).on("click",function(e){$(e.target).is(".payment-content , .payment-content *")||t._close()}),this.$watch("customer.province_id",function(t){this.customer.district_id=""}),t.loader=!0}}),Vue.component("setting",{template:'\n        <div>\n            <div ref="modalSetting" class="modal fade modal-setting" role="dialog" >\n                <div class="modal-dialog " role="document" >\n                    <div class="modal-content" >\n                        <div class="modal-header">\n                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n                            <h4 class="modal-title">Cấu hình</h4>\n                        </div>\n                        <div class="modal-body">\n                            <ul class="nav nav-tabs" role="tablist">\n                                <li :class="{ \'active\' : tab == \'config\'}">\n                                    <a @click.stop.prevent="_changeTab(\'config\')" >Cấu hình chung</a>\n                                </li>\n                                <li :class="{ \'active\' : tab == \'product\'}">\n                                    <a @click.stop.prevent="_changeTab(\'product\')" >Sản phẩm</a>\n                                </li>\n                                <li :class="{ \'active\' : tab == \'group\'}">\n                                    <a @click.stop.prevent="_changeTab(\'group\')" >Khu vực</a>\n                                </li>\n                                <li :class="{ \'active\' : tab == \'source\'}">\n                                    <a @click.stop.prevent="_changeTab(\'source\')" >Bàn</a>\n                                </li>\n                                <li :class="{ \'active\' : tab == \'user\'}">\n                                    <a @click.stop.prevent="_changeTab(\'user\')" >Nhân viên</a>\n                                </li>\n                            </ul>\n                            <div class="tab-content">\n                                <template v-if="loading">\n                                    <div class="box-loading">\n                                        <div class="box-loading-icon">\n                                            <svg class="circular" viewBox="25 25 50 50">\n                                                <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10" />\n                                            </svg>\n                                        </div>\n                                    </div>\n                                </template>\n                                <template v-else>\n                                    <div class="tab-pane active fade in" v-if="tab == \'config\'">\n                                        <p>\n                                            <label><input type="checkbox" v-model="config.allow_print" /> In hóa đơn khi thanh toán</label>\n                                        </p>\n                                        <p>\n                                            <label><input type="checkbox" v-model="config.notify_chief" /> Áp dụng báo bếp</label>\n                                        </p>\n                                        <p>\n                                            <label><input type="checkbox" v-model="config.allow_book" /> Áp dụng đặt bàn</label>\n                                        </p>\n                                        <p>\n                                            <label><input type="checkbox" v-model="config.open_menu" /> Mở thực đơn khi chọn bàn</label>\n                                        </p>\n                                        <p>\n                                            <label><input type="checkbox" v-model="config.auto_hide_product" /> Tự động ẩn sản phẩm khi hết</label>\n                                        </p>\n                                        <p>\n                                            <label><input type="checkbox" v-model="config.allow_import_quantity" /> Cho phép nhập số lượng sản phẩm</label>\n                                        </p>\n                                        <p>\n                                            <label>Thời gian thông báo đặt bàn trước (phút) : </label>\n                                            <span class="inline-block" style="width:100px">\n                                                <money class="form-control" v-model="config.time_book_notify"></money>\n                                            </span>\n                                        </p>\n                                        <div class="text-right pd-15">\n                                            <a @click.stop.prevent="_onSaveConfig()" class="btn btn-success">\n                                                <i class="material-icons">check</i> &nbsp; Lưu cập nhật\n                                            </a>\n                                        </div>\n                                    </div>\n                                    <div class="tab-pane active fade in" v-if="tab == \'product\'">\n                                        \n                                        <div class="row mg-bottom-10">\n                                            <div class="col-xs-12 mg-bottom-10 text-right">\n                                                <a href="#" class="btn btn-success" @click.stop.prevent="_showModalProducts($event)">\n                                                    <i class="far fa-plus"></i> &nbsp; Thêm sản phẩm\n                                                </a>\n                                            </div>\n                                            <div class="col-xs-4">\n                                                <label>Từ khóa</label>\n                                                <div class="form-search">\n                                                    <input v-model.trim="filter.keyword" type="text" class="form-control"  placeholder="Nhập từ khóa cần tìm "/>\n                                                </div>\n                                            </div>\n                                            <div class="col-xs-4">\n                                                <label>Ngành hàng</label>\n                                                <select2 :options="categories" v-model="filter.category_id"></select2>\n                                            </div>\n                                            <div class="col-xs-4">\n                                                <label>Chế biến</label>\n                                                <select2 :options="processings" v-model="filter.processing"></select2>\n                                            </div>\n                                        </div>\n                                        <div class="box-table" >\n                                            <div class="box-header">\n                                                <div class="item">\n                                                    <div class="item-checkbox">\n                                                        <input type="checkbox" v-model="selectAll"  />\n                                                    </div>\n                                                    <div class="item-index">#</div>\n                                                    <div class="item-name">Sản phẩm</div>\n                                                    <div class="item-category">Ngành hàng</div>\n                                                    <div class="item-chief">Chế biến</div>\n                                                    <div class="item-action"></div>\n                                                </div>\n                                            </div>\n                                            <div class="box-body box-body-list-products" >\n                                               \n                                                    <template v-if="listData.length">\n                                                        <div class="item" v-for="(item, index) in listData">\n                                                            <div class="item-checkbox">\n                                                                <input type="checkbox" v-model="checkBox" :value="item._id" />\n                                                            </div>\n                                                            <div class="item-index">{{(products.limit * (products.page - 1)) + index + 1}}</div>\n                                                            <div class="item-name">{{ _.has(item , \'VariantName\')? item.VariantName : \'\'}}</div>\n                                                            <div class="item-category">\n                                                                {{ _.has(item , \'Category.name\') ? item.Category.name : \'\' }}\n                                                            </div>\n                                                            <div class="item-chief">\n                                                                <span @click.stop.prevent="_onClick(item)" class="switch" :class="{ \'is-active\' : item.processing}"></span>\n                                                            </div>\n                                                            <div class="item-action">\n                                                                <a href="#" @click.stop.prevent="_onRemove(item._id)" class="danger"><i class="material-icons">delete</i></a>\n                                                            </div>\n                                                        </div>\n                                                    </template>\n                                                    <template v-else>\n                                                        <div class="pd-top-30 pd-bottom-30 text-center">\n                                                            <h3>Không tìm thấy sản phẩm</h3>\n                                                        </div>\n                                                    </template>\n                                                \n                                            </div>\n                                        </div>\n                                        <hr />\n                                        <div class="row ">\n                                            <div class="col-xs-12">\n                                                <div class="dropup">\n                                                    <button :disabled="checkBox.length == 0" class="btn btn-default dropdown-toggle" type="button"  data-toggle="dropdown">\n                                                        <i class="material-icons">reply_all</i>&nbsp;&nbsp;Chọn thao tác thực hiện trên \n                                                    </button>\n                                                    <ul class="dropdown-menu" aria-labelledby="dropdownMenu2">\n                                                        <li><a @click="_changeState(true)">Chế biến</a></li>\n                                                        <li><a @click="_changeState(false)">Không chế biến</a></li>\n                                                        <li><a @click="_removeAll()">Xóa tất cả sản phẩm khỏi pos</a></li>\n                                                    </ul>\n                                                </div>\n                                            </div>\n                                            \n                                        </div>\n                                    </div>\n                                    <div class="tab-pane active fade in" v-if="tab == \'group\'">\n                                        <div class="text-right mg-bottom-20">\n                                            <a href="#" class="btn btn-success" @click.stop.prevent="_showModalCreateGroup()">\n                                                <i class="far fa-plus"></i> &nbsp; Tạo mới khu vực\n                                            </a>\n                                        </div>\n                                        <div class="box-table" >\n                                            <div class="box-header">\n                                                <div class="item">\n                                                    <div class="item-checkbox"><input type="checkbox" v-model="selectAllGroup" /></div>\n                                                    <div class="item-index">#</div>\n                                                    <div class="item-group-name">Tên khu vực</div>\n                                                    <div class="item-group-warehouse">Chi nhánh</div>\n                                                    <div class="item-group-state">Trạng thái</div>\n                                                    <div class="item-action"></div>\n                                                </div>\n                                            </div>\n                                            <div class="box-body box-body-list-group" >\n                                               \n                                                    <template v-if="groups.length">\n                                                        <div class="item" v-for="(item, index) in groups">\n                                                            <div class="item-checkbox">\n                                                                <input type="checkbox" v-model="checkBoxGroup" :value="item._id" />\n                                                            </div>\n                                                            <div class="item-index">{{index + 1}}</div>\n                                                            <div class="item-group-name">{{item.name}}</div>\n                                                            <div class="item-group-warehouse">{{item.warehouse_name}}</div>\n                                                            <div class="item-group-state">\n                                                                <span class="status success" v-if="item.status == \'publish\'">Đang hoạt động</span>\n                                                                <span class="status danger" v-else-if="item.status == \'trash\'">Ngừng hoạt động</span>\n                                                            </div>\n                                                            <div class="item-group-action">\n                                                                <a href="#" @click.stop.prevent="_onEditGroup(index)" class="primary"><i class="material-icons">info</i></a>\n                                                                <template v-if="item.status == \'publish\'">\n                                                                    <a href="#" @click.stop.prevent="_onGroupChangeStatus(index, \'trash\')" class="danger"><i class="material-icons">delete</i></a>\n                                                                </template>\n                                                                <template v-else-if="item.status ==\'trash\'">\n                                                                    <a href="#" @click.stop.prevent="_onGroupChangeStatus(index, \'publish\')" class="success"><i class="material-icons">restore</i></a>\n                                                                </template>\n                                                            </div>\n                                                        </div>\n                                                    </template>\n                                                    <template v-else>\n                                                        <div class="pd-top-30 pd-bottom-30 text-center">\n                                                            <h3>Không tìm thấy dữ liệu</h3>\n                                                        </div>\n                                                    </template>\n                                               \n                                            </div>\n                                        </div>\n                                        <hr />\n                                        <div class="row ">\n                                            <div class="col-xs-12">\n                                                <div class="dropup">\n                                                    <button :disabled="checkBoxGroup.length == 0" class="btn btn-default dropdown-toggle" type="button"  data-toggle="dropdown">\n                                                        <i class="material-icons">reply_all</i>&nbsp;&nbsp;Chọn thao tác thực hiện trên \n                                                    </button>\n                                                    <ul class="dropdown-menu" aria-labelledby="dropdownMenu2">\n                                                        <li><a @click="_changeStatusSelectedGroup(\'publish\')">Đang hoạt động</a></li>\n                                                        <li><a @click="_changeStatusSelectedGroup(\'trash\')">Ngừng hoạt động</a></li>\n                                                    </ul>\n                                                </div>\n                                            </div>\n                                            \n                                        </div>\n                                    </div>\n                                    <div class="tab-pane active fade in" v-if="tab == \'source\'">\n                                        <div class="text-right mg-bottom-20">\n                                            <a href="#" class="btn btn-success" @click.stop.prevent="_showModalCreateSource()">\n                                                <i class="far fa-plus"></i> &nbsp; Tạo mới bàn\n                                            </a>\n                                        </div>\n                                        <div class="box-table" >\n                                            <div class="box-header">\n                                                <div class="item">\n                                                    <div class="item-checkbox"><input type="checkbox" v-model="selectAllSource" /></div>\n                                                    <div class="item-index">#</div>\n                                                    <div class="item-source-name">Tên Bàn</div>\n                                                    <div class="item-source-group">Khu vực</div>\n                                                    <div class="item-source-warehouse">Chi nhánh</div>\n                                                    <div class="item-source-state">Trạng thái</div>\n                                                    <div class="item-action"></div>\n                                                </div>\n                                            </div>\n                                            <div class="box-body box-body-list-source" >\n                                                \n                                                    <template v-if="sources.length">\n                                                        <div class="item" v-for="(item, index) in sources">\n                                                            <div class="item-checkbox">\n                                                                <input type="checkbox" v-model="checkBoxSource" :value="item._id" />\n                                                            </div>\n                                                            <div class="item-index">{{index + 1}}</div>\n                                                            <div class="item-source-name">{{item.name}}</div>\n                                                            <div class="item-source-group">{{item.group.name}}</div>\n                                                            <div class="item-source-warehouse">{{item.group.warehouse_name}}</div>\n                                                            <div class="item-source-state">\n                                                                <span class="status success" v-if="item.status == \'publish\'">Đang hoạt động</span>\n                                                                <span class="status danger" v-else-if="item.status == \'trash\'">Ngừng hoạt động</span>\n                                                            </div>\n                                                            <div class="item-source-action">\n                                                                <a href="#" @click.stop.prevent="_onEditSource(index)" class="primary"><i class="material-icons">info</i></a>\n                                                                <template v-if="item.status == \'publish\'">\n                                                                    <a href="#" @click.stop.prevent="_onSourceChangeStatus(index, \'trash\')" class="danger"><i class="material-icons">delete</i></a>\n                                                                </template>\n                                                                <template v-else-if="item.status ==\'trash\'">\n                                                                    <a href="#" @click.stop.prevent="_onSourceChangeStatus(index, \'publish\')" class="success"><i class="material-icons">restore</i></a>\n                                                                </template>\n                                                            </div>\n                                                        </div>\n                                                    </template>\n                                                    <template v-else>\n                                                        <div class="pd-top-30 pd-bottom-30 text-center">\n                                                            <h3>Không tìm thấy dữ liệu</h3>\n                                                        </div>\n                                                    </template>\n                                                \n                                            </div>\n                                        </div>\n                                        <hr />\n                                        <div class="row ">\n                                            <div class="col-xs-12">\n                                                <div class="dropup">\n                                                    <button :disabled="checkBoxSource.length == 0" class="btn btn-default dropdown-toggle" type="button"  data-toggle="dropdown">\n                                                        <i class="material-icons">reply_all</i>&nbsp;&nbsp;Chọn thao tác thực hiện trên \n                                                    </button>\n                                                    <ul class="dropdown-menu" aria-labelledby="dropdownMenu2">\n                                                        <li><a @click="_changeStatusSelectedSource(\'publish\')">Đang hoạt động</a></li>\n                                                        <li><a @click="_changeStatusSelectedSource(\'trash\')">Ngừng hoạt động</a></li>\n                                                    </ul>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                    <div class="tab-pane active fade in" v-if="tab == \'user\'">\n                                        <div class="box-table"> \n                                            <div class="box-header">\n                                                <div class="item">\n                                                    <div class="item-index">#</div>\n                                                    <div class="item-user-name">Tên Bàn</div>\n                                                    <div class="item-user-warehouse">Chi nhánh</div>\n                                                    <div class="item-user-state">Trạng thái</div>\n                                                    <div class="item-user-type">Loại nhân viên</div>\n                                                </div>\n                                            </div>\n                                            <div class="box-body" >\n                                                <template v-if="users.data.length">\n                                                    <div class="item" v-for="(item, index) in users.data">\n                                                        <div class="item-index">{{index + 1}}</div>\n                                                        <div class="item-user-name">{{item.name}}</div>\n                                                        <div class="item-user-warehouse">\n                                                            <div v-for="w in item.warehouses">\n                                                                {{w.name}}\n                                                            </div>\n                                                        </div>\n                                                        <div class="item-user-state">\n                                                            <span class="status success" v-if="item.status == \'active\'">Đang hoạt động</span>\n                                                            <span class="status danger" v-else-if="item.status == \'trash\'">Ngừng hoạt động</span>\n                                                        </div>\n                                                        <div class="item-user-type">\n                                                            <select2 :options="users.type" v-model="item.type_pos" placeholder="Chọn loại nhân viên"></select2>\n                                                        </div>\n                                                    </div>\n                                                </template>\n                                                <template v-else>\n                                                    <div class="pd-top-30 pd-bottom-30 text-center">\n                                                        <h3>Không tìm thấy dữ liệu</h3>\n                                                    </div>\n                                                </template>\n                                            </div>\n                                        </div>\n                                        <div class="text-right pd-10 mg-top-20">\n                                            <button class="btn btn-success" @click.stop.prevent="_saveListUser()">\n                                                <i class="material-icons">check</i>&nbsp;Lưu cập nhật\n                                            </button>\n                                        </div>\n                                    </div>\n                                </template>\n                            </div>\n                        </div>\n                        <div class="modal-footer">\n                            \n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div ref="modalProduct" class="modal fade modal-list-products" role="dialog" >\n                <div class="modal-dialog " role="document" >\n                    <div class="modal-content" >\n                        <div class="modal-header">\n                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n                            <h4 class="modal-title">Danh sách sản phẩm</h4>\n                        </div>\n                        <div class="modal-body">\n                            <div class="row mg-bottom-10">\n                                <div class="col-xs-6">\n                                    <label>Từ khóa</label>\n                                    <div class="form-search">\n                                        <input type="text" class="form-control" v-model="products.keyword" placeholder="Nhập từ khóa cần tìm "/>\n                                    </div>\n                                </div>\n                                <div class="col-xs-6">\n                                    <label>Ngành hàng</label>\n                                    <select2 :options="categories" v-model="products.category_id"></select2>\n                                </div>\n                            </div>\n                            <div class="table-responsive">\n                                <table class="table table-hover table-setting">\n                                    <thead>\n                                        <tr>\n                                            <th class="td-checkbox"><input type="checkbox" v-model="selectAllProduct" /></th>\n                                            <th class="td-index">#</th>\n                                            <th class="td-name">Tên sản phẩm</th>\n                                            <th class="td-category">Danh mục</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody>\n                                        <template v-if="products.data.length">\n                                            <tr v-for="(item, index) in products.data" \n                                            @click="_addCheckbox(item._id , $event)"\n                                            :class="{\'is-active\' : checkBoxProduct.indexOf(item._id) >= 0}" >\n                                                <td class="td-checkbox"><input type="checkbox" v-model="checkBoxProduct" :value="item._id" /></td>\n                                                <td class="td-index">{{(products.limit * (products.page - 1)) + index + 1}}</td>\n                                                <td class="td-name">{{ _.has(item , \'VariantName\')? item.VariantName : \'\'}}</td>\n                                                <td class="td-category">{{ _.has(item , \'Category.name\') ? item.Category.name : \'\' }}</td>\n\n                                            </tr>\n                                        </template>\n                                        <template v-else>\n                                            <tr>\n                                                <td colspan="4" class="text-center pd-top-20 pd-bottom-20">\n                                                    <h3>Không tìm thấy dữ liệu !</h3>\n                                                </td>\n                                            </tr>\n                                        </template>\n                                    </tbody>\n                                </table>\n                            </div>\n                        </div>\n                        <div class="modal-footer">\n                            <div class="row">\n                                <div class="col-xs-8 text-left" >\n                                    <pagination :total="products.total" :current="products.page" :change="_changePage"></pagination>\n                                </div>\n                                <div class="col-xs-4 text-right">\n                                    <a href="#" @click.stop.prevent="_save()" class="btn btn-primary" :disabled="!checkBoxProduct.length">\n                                        <i class="far fa-check"></i>&nbsp;&nbsp;Thêm <strong v-if="checkBoxProduct.length">{{checkBoxProduct.length}}</strong> sản phẩm đã chọn\n                                    </a>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    ',props:{show:{required:!0,type:Boolean}},data:function(){return{tab:"config",checkBoxProduct:[],checkBox:[],checkBoxSource:[],checkBoxGroup:[],products:{data:[],limit:10,total:0,page:1,keyword:"",category_id:"all",loading:!1,timeout:null},groups:[],loading:!0,categories:[],data:[],keyword:"",category_id:"",filter:{keyword:"",category_id:"all",processing:"all"},processings:[{_id:"all",name:"Tất cả"},{_id:"true",name:"Có chế biến"},{_id:"false",name:"Không chế biến"}],warehouses:[],sources:[],group_keys:[],users:{loading:!1,data:[],type:[{_id:"cashier",name:"Thu ngân"},{_id:"chief",name:"Bếp"},{_id:"manager",name:"Quản lý"}]},config:{}}},methods:{_changeTab:function(t){if(this.tab!=t)switch(t){case"product":this.tab=t,this._loadAllowPosProduct();break;case"group":this.tab=t,this._loadListGroup();break;case"source":this.tab=t,this._loadListSource();break;case"user":this.tab=t,this._loadListUsers();break;default:this.tab=t}},_load:function(t,e){var n=this;this.products.loading=!0,$.post("/admin/sales/pos/postLoadProductForSaleSource",{page:t,limit:this.products.limit,keyword:this.products.keyword,category_id:"all"==this.products.category_id?"":this.products.category_id},function(t){console.log(t),403!=t.status&&0==t.error&&(n.products.data=t.products,n.products.limit=t.limit,n.products.page=t.page,n.products.total=t.total,"function"==typeof e&&e())}).fail(function(){}).always(function(){n.products.loading=!1})},_changePage:function(t){console.log(t),this.products.loading||this._load(t)},_showModalProducts:function(){var t=this;this._load(1,function(){$(t.$refs.modalProduct).modal("show"),$(t.$refs.modalSetting).removeClass("in")})},_addCheckbox:function(t,e){var n=e.target.tagName.toLowerCase();if("a"!=n&&"i"!=n&&"span"!=n&&"input"!=n){var i=this.checkBoxProduct.indexOf(t);-1==i?this.checkBoxProduct.push(t):this.checkBoxProduct.splice(i,1)}},_save:function(){var t=this;this.$root.showLoader(),$.post("/admin/sales/pos/postChangeProductAllowPOS",{product_ids:this.checkBoxProduct},function(e){403!=e.status&&0==e.error&&0==e.error&&(e.products.forEach(function(e){t.data.push(e)}),$(t.$refs.modalProduct).modal("hide"))}).fail(function(){}).always(function(){t.$root.closeLoader()})},_loadConfig:function(){var t=this;this.loading=!0,$.post("/admin/sales/pos/postLoadSettingPos",{},function(e){403!=e.status&&0==e.error&&(t.config=e.data)}).fail(function(){}).always(function(){t.loading=!1})},_loadAllowPosProduct:function(t){var e=this;this.loading=!0,$.post("/admin/sales/pos/postLoadProductAllowPOS",{},function(n){403!=n.status&&0==n.error&&(e.data=n.products,n.categories.unshift({_id:"all",name:"Tất cả"}),e.categories=n.categories,"function"==typeof t&&t())}).fail(function(){}).always(function(){e.loading=!1})},_loadListGroup:function(t){var e=this;this.loading=!0,$.post("/admin/sales/pos/postLoadSaleGroupSource",{},function(n){403!=n.status&&0==n.error&&(e.groups=n.sale_group_source,e.warehouses=n.warehouses,"function"==typeof t&&t())}).fail(function(){}).always(function(){e.loading=!1})},_loadListSource:function(t){var e=this;this.loading=!0,$.post("/admin/sales/pos/postLoadSaleSource",{},function(n){403!=n.status&&0==n.error&&(e.sources=n.sale_source,e.group_keys=n.sale_group_source,"function"==typeof t&&t())}).fail(function(){}).always(function(){e.loading=!1})},_loadListUsers:function(t){var e=this;this.loading=!0,$.post("/admin/sales/pos/postLoadUserPos",{},function(n){403!=n.status&&0==n.error&&(e.users.data=n.users,"function"==typeof t&&t())}).fail(function(){}).always(function(){e.loading=!1})},_removeAll:function(){var t=this;this.$root.comfirm("Thông báo !","Bạn có muốn xóa những sản phẩm đã chọn khỏi POS ?",{save:{text:"Xác nhận",btnClass:"btn-success",keys:["enter"],action:function(){t.$root.showLoader(),$.post("/admin/sales/pos/postRemoveAllowPOS",{product_ids:t.checkBox},function(e){403!=e.status&&0==e.error&&(t.data=t.data.filter(function(e){return-1==t.checkBox.indexOf(e._id)}),t.checkBox=[])}).fail(function(){}).always(function(){t.$root.closeLoader()})}},close:{text:"Đóng",btnClass:"btn-default",keys:["esc"]}})},_changeState:function(t){var e=this,n="";n=1==t?"Bạn có muốn áp dụng chế biến cho những sản phẩm đã chọn ?":"Bạn có muốn áp dụng không chế biến cho những sản phẩm đã chọn ?",this.$root.comfirm("Thông báo !",n,{save:{text:"Xác nhận",btnClass:"btn-success",keys:["enter"],action:function(){e.$root.showLoader(),$.post("/admin/sales/pos/postChangeProcessing",{product_ids:e.checkBox,processing:t},function(n){403!=n.status&&0==n.error&&(e.data=e.data.map(function(n){return e.checkBox.indexOf(n._id)>=0&&(n.processing=t),n}),helper.dialog(n.message,"check","success",1e3),socket.emit("pos_user_update_config",{}))}).fail(function(){}).always(function(){e.$root.closeLoader()})}},close:{text:"Đóng",btnClass:"btn-default",keys:["esc"]}})},_onClick:function(t){var e=this;$.post("/admin/sales/pos/postChangeProcessing",{product_ids:[t._id],processing:!t.processing},function(e){403!=e.status&&0==e.error&&(t.processing=!t.processing)}).fail(function(){}).always(function(){e.$root.closeLoader()})},_onRemove:function(t){var e=this;this.$root.comfirm("Thông báo !","Bạn có muốn xóa sản phẩm đã chọn khỏi POS ?",{save:{text:"Xác nhận",btnClass:"btn-success",keys:["enter"],action:function(){e.$root.showLoader(),$.post("/admin/sales/pos/postRemoveAllowPOS",{product_ids:[t]},function(n){403!=n.status&&0==n.error&&(e.data=e.data.filter(function(e){return e._id!=t}))}).fail(function(){}).always(function(){e.$root.closeLoader()})}},close:{text:"Đóng",btnClass:"btn-default",keys:["esc"]}})},_onEditGroup:function(t){var e=this;if(!(t<0))var n=this,i=!0,s=$.confirm({title:"Cập nhật ",content:'\n                    <form id="form-edit-group" @submit.stop.prevent="onSubmit">\n                        <div class="form-group mg-bottom-10">\n                            <label>Tên khu vực</label>\n                            <input ref="name" type="text" v-model="name" placeholder="Nhập tên khu vực" class="name form-control" required />\n                        </div>\n                        <div class="form-group">\n                            <label>Chi nhánh</label>\n                            <select2 class="form-control" :options="warehouses" v-model="warehouse_id" placeholder="Chọn chi nhánh"></select2>\n                        </div>\n                    </form>\n                ',type:"green",backgroundDismiss:function(){return"backdrop"},buttons:{backdrop:{isHidden:!0,action:function(){return i}},save:{text:"Xác nhận",btnClass:"btn-success",action:function(){var a=createGroup.name,o=createGroup.warehouse_id;return""==a?($.dialog("Chưa nhập tên khu vực !"),!1):""==o?($.dialog("Chưa chọn kho hàng !"),!1):(i=!1,s.showLoading(!0),new Promise(function(i,s){$.post("/admin/sales/pos/postUpdateSaleGroupSource",{_id:n.groups[t]._id,name:a,warehouse_id:o},function(n){403!=n.status&&0==n.error&&(e.$set(e.groups,t,n.group),i(!0))}).fail(function(){i(!1)}).always(function(){})}))}},close:{text:"Đóng",btnClass:"btn-default"}},onOpenBefore:function(){s.showLoading()},onContentReady:function(){createGroup=new Vue({el:"#form-edit-group",data:{name:n.groups[t].name,warehouse_id:n.groups[t].warehouse_id,warehouses:n.warehouses},methods:{onSubmit:function(){s.$$save.trigger("click")}},mounted:function(){s.hideLoading(),$(this.$refs.name).select()}})}})},_onEditSource:function(t){var e=this;if(!(t<0))var n=this,i=$.confirm({title:"Cập nhật !",content:'\n                    <form id="form-create-source" @submit.stop.prevent="onSubmit">\n                        <div class="form-group mg-bottom-10">\n                            <label>Tên bàn</label>\n                            <input ref="name" type="text" v-model="name" placeholder="Nhập tên bàn" class="name form-control" required />\n                        </div>\n                        <div class="form-group">\n                            <label>Chi khu vực</label>\n                            <select2 class="form-control" :options="groups" v-model="group_id" placeholder="Chọn khu vực"></select2>\n                        </div>\n                    </form>\n                ',type:"green",buttons:{save:{text:"Xác nhận",btnClass:"btn-success",action:function(){var n=createSource.name,i=createSource.group_id;return""==n?($.dialog("Chưa nhập tên bàn !"),!1):""==i?($.dialog("Chưa chọn khu vực !"),!1):(e.$root.showLoader(),new Promise(function(s,a){$.post("/admin/sales/pos/postUpdateSaleSource",{_id:e.sources[t]._id,name:n,group_id:i},function(n){403!=n.status&&0==n.error&&(e.$set(e.sources,t,n.source),s(!0))}).fail(function(){}).always(function(){e.$root.closeLoader()})}))}},close:{text:"Đóng",btnClass:"btn-default"}},onOpenBefore:function(){i.showLoading()},onContentReady:function(){createSource=new Vue({el:"#form-create-source",data:{name:n.sources[t].name,group_id:n.sources[t].group_id,groups:n.group_keys},methods:{onSubmit:function(){i.$$save.trigger("click")}},mounted:function(){i.hideLoading(),$(this.$refs.name).focus()}})}})},_onGroupChangeStatus:function(t,e){var n=this,i=!0,s="",a="";if("publish"==e)s="Bạn có muốn khôi phục khu vực này ?",a="green";else{if("trash"!=e)return;s="Bạn có muốn xóa khu vực này ?",a="red"}var o=$.confirm({title:"Xác nhận ",content:s,type:a,backgroundDismiss:function(){return"backdrop"},buttons:{backdrop:{isHidden:!0,action:function(){return i}},save:{text:"Xác nhận",btnClass:"btn-success",action:function(){return i=!1,o.showLoading(!0),new Promise(function(i,s){$.post("/admin/sales/pos/postChangeStatusSaleGroupSource",{group_ids:[n.groups[t]._id],status:e},function(s){403!=s.status&&0==s.error&&(n.groups[t].status=e,i(!0))}).fail(function(){}).always(function(){})})}},close:{text:"Đóng",btnClass:"btn-default"}}})},_onSourceChangeStatus:function(t,e){var n=this,i=!0,s="",a="";if("publish"==e)s="Bạn có muốn khôi phục bàn này ?",a="green";else{if("trash"!=e)return;s="Bạn có muốn xóa bàn này ?",a="red"}var o=$.confirm({title:"Xác nhận ",content:s,type:a,backgroundDismiss:function(){return"backdrop"},buttons:{backdrop:{isHidden:!0,action:function(){return i}},save:{text:"Xác nhận",btnClass:"btn-success",action:function(){return i=!1,o.showLoading(!0),new Promise(function(i,s){$.post("/admin/sales/pos/postChangeStatusSaleSource",{source_ids:[n.sources[t]._id],status:e},function(s){403!=s.status&&0==s.error&&(n.sources[t].status=e,i(!0))}).fail(function(){}).always(function(){})})}},close:{text:"Đóng",btnClass:"btn-default"}}})},_showModalCreateGroup:function(){var t=this,e=this,n=null,i=$.confirm({title:"Tạo mới !",content:'\n                    <form id="form-create-group" @submit.stop.prevent="onSubmit">\n                        <div class="form-group mg-bottom-10">\n                            <label>Tên khu vực</label>\n                            <input ref="name" type="text" v-model="name" placeholder="Nhập tên khu vực" class="name form-control" required />\n                        </div>\n                        <div class="form-group">\n                            <label>Chi nhánh</label>\n                            <select2 class="form-control" :options="warehouses" v-model="warehouse_id" placeholder="Chọn chi nhánh"></select2>\n                        </div>\n                    </form>\n                ',type:"green",buttons:{save:{text:"Xác nhận",btnClass:"btn-success",action:function(){var e=n.name,i=n.warehouse_id;return""==e?($.dialog("Chưa nhập tên khu vực !"),!1):""==i?($.dialog("Chưa chọn kho hàng !"),!1):(t.$root.showLoader(),new Promise(function(n,s){$.post("/admin/sales/pos/postAddSaleGroupSource",{name:e,warehouse_id:i},function(e){403!=e.status&&0==e.error&&(t.groups.push(e.data),n(!0))}).fail(function(){}).always(function(){t.$root.closeLoader()})}))}},close:{text:"Đóng",btnClass:"btn-default"}},onOpenBefore:function(){i.showLoading()},onContentReady:function(){n=new Vue({el:"#form-create-group",data:{name:"",warehouse_id:"",warehouses:e.warehouses},methods:{onSubmit:function(){i.$$save.trigger("click")}},mounted:function(){i.hideLoading(),$(this.$refs.name).focus()}})}})},_showModalCreateSource:function(){var t=this,e=this,n=null,i=$.confirm({title:"Tạo mới !",content:'\n                    <form id="form-create-source" @submit.stop.prevent="onSubmit">\n                        <div class="form-group mg-bottom-10">\n                            <label>Tên bàn</label>\n                            <input ref="name" type="text" v-model="name" placeholder="Nhập tên bàn" class="name form-control" required />\n                        </div>\n                        <div class="form-group">\n                            <label>Chi khu vực</label>\n                            <select2 class="form-control" :options="groups" v-model="group_id" placeholder="Chọn khu vực"></select2>\n                        </div>\n                    </form>\n                ',type:"green",buttons:{save:{text:"Xác nhận",btnClass:"btn-success",action:function(){var e=n.name,i=n.group_id;return""==e?($.dialog("Chưa nhập tên bàn !"),!1):""==i?($.dialog("Chưa chọn khu vực !"),!1):(t.$root.showLoader(),new Promise(function(n,s){$.post("/admin/sales/pos/postAddSaleSource",{name:e,group_id:i},function(e){403!=e.status&&0==e.error&&(t.sources.push(e.data),n(!0))}).fail(function(){}).always(function(){t.$root.closeLoader()})}))}},close:{text:"Đóng",btnClass:"btn-default"}},onOpenBefore:function(){i.showLoading()},onContentReady:function(){n=new Vue({el:"#form-create-source",data:{name:"",group_id:"",groups:e.group_keys},methods:{onSubmit:function(){i.$$save.trigger("click")}},mounted:function(){i.hideLoading(),$(this.$refs.name).focus()}})}})},_changeStatusSelectedGroup:function(t){var e=this;if(this.checkBoxGroup.length){var n=!0,i="",s="";if("publish"==t)i="Bạn có muốn khôi phục tất cả khu vực đã chọn ?",s="green";else{if("trash"!=t)return;i="Bạn có muốn xóa tất cả xóa đã chọn ?",s="red"}var a=$.confirm({title:"Xác nhận ",content:i,type:s,backgroundDismiss:function(){return"backdrop"},buttons:{backdrop:{isHidden:!0,action:function(){return n}},save:{text:"Xác nhận",btnClass:"btn-success",action:function(){return n=!1,a.showLoading(!0),new Promise(function(n,i){$.post("/admin/sales/pos/postChangeStatusSaleGroupSource",{group_ids:e.checkBoxGroup,status:t},function(i){403!=i.status&&0==i.error&&(e.groups=e.groups.map(function(n){return e.checkBoxGroup.indexOf(n._id)>=0&&(n.status=t),n}),n(!0))}).fail(function(){}).always(function(){})})}},close:{text:"Đóng",btnClass:"btn-default"}}})}},_changeStatusSelectedSource:function(t){var e=this;if(this.checkBoxSource.length){var n=!0,i="",s="";if("publish"==t)i="Bạn có muốn khôi phục tất cả bàn đã chọn ?",s="green";else{if("trash"!=t)return;i="Bạn có muốn xóa tất cả bàn đã chọn ?",s="red"}var a=$.confirm({title:"Xác nhận ",content:i,type:s,backgroundDismiss:function(){return"backdrop"},buttons:{backdrop:{isHidden:!0,action:function(){return n}},save:{text:"Xác nhận",btnClass:"btn-success",action:function(){return n=!1,a.showLoading(!0),new Promise(function(n,i){$.post("/admin/sales/pos/postChangeStatusSaleSource",{source_ids:e.checkBoxSource,status:t},function(i){403!=i.status&&0==i.error&&(e.sources=e.sources.map(function(n){return e.checkBoxSource.indexOf(n._id)>=0&&(n.status=t),n}),n(!0))}).fail(function(){}).always(function(){})})}},close:{text:"Đóng",btnClass:"btn-default"}}})}},_saveListUser:function(){var t=this;this.$root.showLoader();var e=this.users.data.map(function(t){return{_id:t._id,type_pos:t.type_pos}});$.post("/admin/sales/pos/postUpdateUserPos",{users:e},function(t){403!=t.status&&0==t.error&&helper.dialog(t.message,"check","success",2e3)}).fail(function(){}).always(function(){t.$root.closeLoader(300)})},_onSaveConfig:function(){var t=this;this.$root.showLoader(),$.post("/admin/sales/pos/postUpdateSettingPos",{setting:this.config},function(t){403!=t.status&&0==t.error&&(helper.dialog(t.message,"check","success",2e3),socket.emit("pos_user_update_config",{}))}).fail(function(){}).always(function(){t.$root.closeLoader(300)})}},computed:{selectAllProduct:{get:function(){var t=this;if(this.products.data.length){var e=!0;return this.products.data.forEach(function(n){-1==t.checkBoxProduct.indexOf(n._id)&&(e=!1)}),e}return!1},set:function(t){var e=this;t?this.products.data.forEach(function(t){-1==e.checkBoxProduct.indexOf(t._id)&&e.checkBoxProduct.push(t._id)}):this.products.data.forEach(function(t){var n=e.checkBoxProduct.indexOf(t._id);n>=0&&e.checkBoxProduct.splice(n,1)})}},selectAll:{get:function(){var t=this;if(this.data.length){var e=!0;return this.data.forEach(function(n){-1==t.checkBox.indexOf(n._id)&&(e=!1)}),e}return!1},set:function(t){var e=this;t?this.data.forEach(function(t){-1==e.checkBox.indexOf(t._id)&&e.checkBox.push(t._id)}):this.data.forEach(function(t){var n=e.checkBox.indexOf(t._id);n>=0&&e.checkBox.splice(n,1)})}},selectAllSource:{get:function(){var t=this;if(this.sources.length){var e=!0;return this.sources.forEach(function(n){-1==t.checkBoxSource.indexOf(n._id)&&(e=!1)}),e}return!1},set:function(t){var e=this;t?this.sources.forEach(function(t){-1==e.checkBoxSource.indexOf(t._id)&&e.checkBoxSource.push(t._id)}):this.sources.forEach(function(t){var n=e.checkBoxSource.indexOf(t._id);n>=0&&e.checkBoxSource.splice(n,1)})}},selectAllGroup:{get:function(){var t=this;if(this.groups.length){var e=!0;return this.groups.forEach(function(n){-1==t.checkBoxGroup.indexOf(n._id)&&(e=!1)}),e}return!1},set:function(t){var e=this;t?this.groups.forEach(function(t){-1==e.checkBoxGroup.indexOf(t._id)&&e.checkBoxGroup.push(t._id)}):this.groups.forEach(function(t){var n=e.checkBoxGroup.indexOf(t._id);n>=0&&e.checkBoxGroup.splice(n,1)})}},listData:function(){var t=this;return this.data.filter(function(e){var n=!0,i=!0,s=!0;if(""!=t.filter.keyword.trim()){var a=helper.convertCharacters(t.filter.keyword.trim().toLowerCase());-1==helper.convertCharacters(e.name.trim().toLowerCase()).indexOf(a)&&(i=!1)}return"all"!=t.filter.category_id&&e.category_id!=t.filter.category_id&&(n=!1),"all"!=t.filter.processing&&("true"==t.filter.processing?0==e.processing&&(s=!1):1==e.processing&&(s=!1)),n&&i&&s})}},watch:{"products.keyword":function(t){var e=this;clearTimeout(this.products.timeout),this.products.timeout=setTimeout(function(){e._load(e.products.page)},1e3)},"products.category_id":function(t){this._load(this.products.page)}},mounted:function(){var t=this;$(this.$refs.modalSetting).modal("show"),$(this.$refs.modalSetting).on("hidden.bs.modal",function(e){t.$emit("update:show",!1),$.confirm({title:"Thông báo !",content:"Bạn có muốn tải lại trang để cập nhật cấu hình mới ?",buttons:{save:{text:"Đồng ý",btnClass:"btn-success",action:function(){document.location.reload()}},close:{text:"Đóng",btnClass:"btn-default"}}})}),$(this.$refs.modalProduct).on("hidden.bs.modal",function(e){$(t.$refs.modalSetting).addClass("in"),$("body").addClass("modal-open")}),this._loadConfig()}}),Vue.component("list-tables",{template:'\n\t\t<div class="box-list-sources">\n            <div class="box-list-sources-head">\n                <div class="list-sources-navbar" >\n                    <ul class="nav nav-groups" >\n                        <li :class="{ active : options.group == \'all\'}">\n                            <a @click.stop.prevent="changeGroup(\'all\')">Tất cả</a>\n                        </li>\n                        <li v-for="item in groups" :class="{ active : options.group ==  item._id}">\n                            <a @click.stop.prevent="changeGroup(item._id)">{{item.name}}</a>\n                        </li>\n                    </ul>\n                </div>\n                <div class="form-search-wrap">\n                    <div class="form-search">\n                        <i class="fas fa-search"></i>\n                        <input type="text" class="form-control" placeholder="Nhập từ khóa cần tìm ..." v-model.trim="options.keywordSource">\n                    </div>\n                    <div class="form-search-status">\n                        Sử dụng : <span>{{list.active}}</span> / {{list.total}} bàn\n                    </div>\n                </div>\n            </div>\n            <div class="box-list-sources-body">\n                <template  v-if="data.length">\n                    <div class="box-list-sources-body-wrapper">\n                        <div class="box-list-sources-body-tab" :class="{\'is-active\' : options.tableView == \'grid\'}">\n                            <template v-if="list.data.length">\n                                <div  class="list-wrap" style="overflow: hidden auto">\n                                    <div class="list-sources">\n                                        <template v-for="(item, index) in list.data">\n                                            <item-table :index="index" :user="user" :table.sync="item"  :data.sync="data" :options.sync="options"></item-table>\n                                        </template>\n                                    </div>\n                                </div>\n                            </template>\n                            <template v-else>\n                                <div  class="list-empty" >\n                                    <div class="text-center">\n                                        <h3 class="text-danger">Không tìm thấy dữ liệu</h3>\n                                    </div>\n                                </div>\n                            </template>\n                            \n                        </div>\n                        <div class="box-list-sources-body-tab" :class="{\'is-active\' : options.tableView == \'list\'}">\n                            <div class="list-wrap" >\n                                <div class="table table-sources">\n                                    <div class="table-head">\n                                        <div class="row">\n                                            <div class="col index">#</div>\n                                            <div class="col center">\n                                                <div class="col name">Tên bàn</div>\n                                                <div class="col group">Khu vực</div>\n                                                <div class="col state">Trạng thái</div>\n                                                <div class="col products">Chi tiết</div>\n                                                <div class="col user">Nhân viên</div>\n                                            </div>\n                                            <div class="col actions">Tác vụ</div>\n                                        </div>\n                                    </div>\n                                    <template v-if="list.data.length">\n                                        <div class="table-body" >\n                                            <template v-for="(item, index) in list.data">\n                                                <item-table :index="index" :user="user" :table.sync="item"  :data.sync="data" :options.sync="options"></item-table>\n                                            </template>\n                                        </div>\n                                    </template>\n                                    <template v-else>\n                                        <div  class="table-body">\n                                            <div class="text-center">\n                                                <h3 class="text-danger">Không tìm thấy dữ liệu</h3>\n                                            </div>\n                                        </div>\n                                    </template>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </template>\n                <template v-else>\n                    <div class="list-empty" >\n                        <div class="text-center">\n                            <i class="fas fa-exclamation-triangle"></i>\n                            <strong>Chưa có bàn !</strong>\n                        </div>\n                    </div>\n                </template>\n            </div>\n            <div class="box-list-sources-foot">\n                <div class="view-type">\n                    <a :class="{\'is-active\' : options.tableView ==\'grid\'}" @click.stop.prevent="options.tableView = \'grid\'" ><i class="material-icons">view_module</i></a>\n                    <a :class="{\'is-active\' : options.tableView ==\'list\'}" @click.stop.prevent="options.tableView = \'list\'" ><i class="material-icons">view_list</i></a>\n                </div>\n                <div class="view-filter">\n                    <label><input type="checkbox" v-model="options.allowOpen"> Mở thực đơn khi chọn bàn</label>\n                </div>\n                <div class="view-sort">\n                    <select2 :options="states" v-model="options.state"></select2>\n                </div>\n            </div>\n        </div>\n\n\t',props:{data:{},options:{},groups:{},user:{}},data:function(){return{states:[{_id:"all",name:"Tất cả"},{_id:"empty",name:"Chưa sử dụng"},{_id:"booked",name:"Đang sử dụng"}],navbar:"auto"}},methods:{changeGroup:function(t){this.options.group!=t&&(this.options.group=t)}},computed:{list:function(){var t=this,e=helper.convertCharacters(this.options.keywordSource.toLowerCase()),n=0;return{data:t.data.filter(function(i){var s=!0,a=!0,o=!0;return"booked"==i.state&&n++,"booked"==t.options.state||"wait"==t.options.state?o=i.state==t.options.state:"empty"!=t.options.state&&""!=t.options.state||(o=""==i.state||"empty"==i.state),"all"!=t.options.group&&(s=i.group_id==t.options.group),""!=e&&(a=i.name_search.indexOf(e)>=0),s&&a&&o}),active:n,total:t.data.length}}},mounted:function(){}}),Vue.component("item-table",{template:'\n\t\t<div v-if="options.tableView ==\'grid\'" class="item-source" :class="_class()">\n            <img :src="$root.images.square" class="item-source-grid" />\n            <div class="item-source-wrap" @click="_onClick($event)">\n                <div class="item-source-header">\n                    <template v-if="table.hasOwnProperty(\'current_user\') && table.current_user != \'\' && table.relation_id ==\'\' ">\n                        <div class="item-source-user" ><i class="fas fa-user"></i>{{ table.current_user  | username}}</div>\n                    </template>\n                    <div class="item-source-dropdown">\n                        <template v-if="_show()">\n                            <div class="dropdown" >\n                                <a class="dropdown-toggle" data-toggle="dropdown"><i\n                                        class="fa fa-ellipsis-v"></i></a>\n                                <ul class="dropdown-menu">\n                                    <li><a @click="$root.showModalSwitchTable(table._id )">Chuyển bàn</a></li>\n                                    <li><a @click="$root.showModalJoinTable(table._id )">Ghép/gộp bàn</a></li>\n                                    <li><a @click="$root.clearTable(table._id)">Hủy bàn</a></li>\n                                </ul>\n                            </div>\n                        </template>\n                    </div>\n                </div>\n                <div class="item-source-icon">\n                    <img :src="$root.images.table"/>\n                </div>\n                <div class="item-source-name">{{table.name}}</div>\n                <template v-if="table.state == \'booked\'">\n                    <div class="item-source-info text-center"  v-html="info"></div>\n                </template>\n            </div>\n        </div>\n        <div v-else class="row">\n            <div class="col index">{{index + 1}}</div>\n            <div class="col center">\n                <div class="col name">{{table.name}}</div>\n                <div class="col group">{{groupName}}</div>\n                <div class="col state">\n                    <template v-if="table.state ==\'empty\' || table.state == \'\'">\n                        - - -\n                    </template>\n                    <template v-else-if="table.state == \'booked\' ">\n                        <span class="status success" v-if="table.relation_id == \'\'">\n                            Đang sử dụng\n                        </span>\n                        <span class="status warning" v-else>\n                            Đang ghép bàn\n                        </span>\n                    </template>\n                    <template v-else>\n                        <span class="status success" v-if="table.state == \'booked\'">\n                            Đang sử dụng\n                        </span>\n                    </template>\n                </div>\n                <div class="col">\n                    <span v-if="table.state == \'booked\'" v-html="info"></span>\n                    <span v-else>- - -</span>\n                </div>\n                <div class="col user">\n                    <template v-if="table.hasOwnProperty(\'current_user\') && table.current_user != \'\' && table.relation_id ==\'\' ">\n                        {{ table.current_user  | username}}\n                    </template>\n                    <template v-else>- - -</template>\n                </div>\n            </div>\n            <div class="col actions">\n                <a href="#" class="text-primary"  @click.stop.prevent="_onClick($event)">\n                    <i class="material-icons">info</i>\n                </a>\n                <div class="btn-group" >\n                    <a  data-toggle="dropdown"  :class="{\'is-active\' : _show()}">\n                        <i class="material-icons text-darl">more_vert</i>\n                    </a>\n                    <ul class="dropdown-menu dropdown-menu-right" v-if="_show()">\n                        <li><a @click="$root.showModalSwitchTable(table._id )">Chuyển bàn</a></li>\n                        <li><a @click="$root.showModalJoinTable(table._id )">Ghép/gộp bàn</a></li>\n                        <li><a @click="$root.clearTable(table._id)">Hủy bàn</a></li>\n                    </ul>\n                </div>\n            </div>\n        </div>\n\t',props:{table:{},data:{},options:{},user:{},index:{}},data:function(){return{}},methods:{_class:function(){return""!=this.table.relation_id&&null!=this.table.relation_id?"is-relation":this.options.activeTable==this.table._id?"is-active":"booked"==this.table.state?"booked":"wait"==this.table.state?"wait":void 0},_onClick:function(t){var e=this;if(this.table._id!=e.options.activeTable&&(void 0==t||!$(t.target).is(".dropdown , .dropdown *")))if(""==e.table.relation_id||null==e.table.relation_id)"empty"==e.table.state||""==e.table.state?$.post("/admin/sales/pos/postConfirmAccessTableCustomer",{_id:e.table._id},function(t){if(403!=t.status)if(0==t.error){var n=t.hasOwnProperty("message")?t.message:"";e.$root.comfirm("Thông báo !",n,{save:{text:"Xác nhận",btnClass:"btn-success",keys:["enter"],action:function(){e.$root.showLoader(),$.post("/admin/sales/pos/postTableAccessCustomer",{_id:e.table._id},function(t){403!=t.status&&(0==t.error?(e.$root.updateSource({source:t.data}),e.options.activeTable=e.table._id,e.options.allowOpen&&(e.options.tab="products"),helper.dialog(t.message,"check","success",1e3)):helper.dialog(t.message,"warning","warning",1e3))}).fail(function(){}).always(function(){e.$root.closeLoader(500)})}},close:{text:"Đóng",btnClass:"btn-default",keys:["esc"]}})}else helper.dialog(t.message,"warning","warning",1e3)}).fail(function(){}).always(function(){}):e.user._id==e.table.current_user||"admin"==e.user.type_pos||"manager"==e.user.type_pos?e.options.allowOpen?(e.$root.showLoader(),e.options.activeTable=e.table._id,e.$nextTick(function(){e.$root.closeLoader(300,function(){e.options.tab="products"})})):e.options.activeTable=e.table._id:$.dialog("Không được phép truy cập bàn này ");else{if(e.options.activeTable==e.table.relation_id)return;e.user._id==e.table.current_user||"admin"==e.user.type_pos||"manager"==e.user.type_pos?e.options.allowOpen?(e.$root.showLoader(),e.options.activeTable=e.table.relation_id,e.$nextTick(function(){e.$root.closeLoader(300,function(){e.options.tab="products"})})):e.options.activeTable=e.table.relation_id:$.dialog("Không được phép truy cập bàn này ")}},_show:function(){return!("booked"!=this.table.state||this.$root.user._id!=this.table.current_user&&"manager"!=this.user.type_pos&&"admin"!=this.user.type_pos||""!=this.table.relation_id&&null!=this.table.relation_id)},_isActive:function(t,e){var n=_.find(this.$root.users,{table:t});return void 0==n?!e&&"":!!e||n.user_name}},computed:{info:function(){var t=0,e=0;if(this.table.hasOwnProperty("relation_id")&&""!=this.table.relation_id){var n=_.find(this.data,{_id:this.table.relation_id});return void 0!=n?"<div> Ghép với <strong>"+n.name+"</strong></div>":""}return this.table.hasOwnProperty("products")&&_.isArray(this.table.products)&&this.table.products.length?(this.table.products.forEach(function(n){t+=n.request_quantity,e+=n.recive_quantity}),"<strong>"+e+"</strong>/"+t+" món"):"Chưa chọn món"},groupName:function(){var t=_.find(this.$root.groups,{_id:this.table.group_id});return void 0==t?"":t.name}}}),Vue.component("list-products",{template:'\n        <div class="box-list-products">\n            <div class="box-list-products-head">\n                <ul class="nav nav-groups">\n                    <li :class="{ active : options.category == \'all\'}">\n                        <a @click.stop.prevent="changeCategory(\'all\')">Tất cả</a>\n                    </li>\n                    <li v-for="item in categories" :class="{ active : options.category ==  item._id}">\n                        <a @click.stop.prevent="changeCategory(item._id)">{{item.name}}</a>\n                    </li>\n                </ul>\n                <div class="form-search-wrap">\n                    <div class="form-search">\n                        <i class="fas fa-search"></i>\n                        <input type="text" class="form-control" placeholder="Nhập từ khóa cần tìm ..." v-model.trim="options.keywordProduct">\n                    </div>\n                    <div class="form-search-status">\n                        Số món : <span>{{list.active}}</span> / {{list.total}} \n                    </div>\n                </div>\n            </div>\n            <div class="box-list-products-body">\n                <template v-if="data.length">\n                    <div class="box-list-sources-body-wrapper">\n                        <div class="box-list-sources-body-tab" :class="{\'is-active\' : options.productView == \'grid\'}">\n                            <template v-if="list.data.length">\n                                <div class="list-wrap" style="overflow: hidden scroll">\n                                   \n                                        <div class="list-products" >\n                                            <div class="item-product" v-for="(item, index) in list.data" @click.stop.prevent="_onClick(item)">\n                                                <div class="item-product-wrap">\n                                                    <div class="item-product-quantity" v-if="item.manage_inventory">\n                                                        <div class="badge">{{item.available_quantity}}</div>\n                                                    </div>\n                                                    <div class="item-product-image">\n                                                        <img :src="$root.images.square" class="item-product-grid" />\n                                                        <template v-if="_.has(item ,\'image.path\')">\n                                                            <div class="item-product-image-wrap">\n                                                                <img :src="\'/\'+item.image.path" class="img-responsive" />\n                                                            </div>\n                                                        </template>\n                                                        <template v-else>\n                                                            <div class="item-product-image-wrap empty">\n                                                                <i class="material-icons">\n                                                                    camera\n                                                                </i>\n                                                            </div>\n                                                        </template>\n                                                    </div>\n                                                    <div class="item-product-title">\n                                                        {{item.name}}\n                                                    </div>\n                                                    <div class="item-product-price">\n                                                        {{item.price_sale | money}}\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                </div>\n                            </template>\n                            <template v-else>\n                                <div  class="list-empty" >\n                                    <div class="text-center">\n                                        <h3 class="text-danger">Không tìm thấy dữ liệu</h3>\n                                    </div>\n                                </div>\n                            </template>\n                        </div>\n                        <div class="box-list-sources-body-tab" :class="{\'is-active\' : options.productView == \'list\'}">\n                            <div class="list-wrap">\n                                <div class="table table-products">\n                                    <div class="table-head">\n                                        <div class="row">\n                                            <div class="col index">#</div>\n                                            <div class="col center">\n                                                <div class="col name">Sản phẩm</div>\n                                                <div class="col category">Danh mục</div>\n                                                <div class="col quantity">Số lượng</div>\n                                                <div class="col price">Đơn giá</div>\n                                            </div>\n                                            <div class="col actions">Tác vụ</div>\n                                        </div>\n                                    </div>\n                                    <template v-if="list.data.length">\n                                        <div class="table-body" >\n                                   \n                                                <template v-for="(item, index) in list.data">\n                                                    <div class="row">\n                                                        <div class="col index">{{index + 1}}</div>\n                                                        <div class="col center">\n                                                            <div class="col name">{{item.name}}</div>\n                                                            <div class="col category">\n                                                                {{_.has(item , \'category.name\') ? item.category.name : \'\'}}\n                                                            </div>\n                                                            <div class="col quantity">\n                                                                <template v-if="item.manage_inventory">{{item.available_quantity}}</template>\n                                                                <template v-else>- - -</template>\n                                                                \n                                                            </div>\n                                                            <div class="col price">{{item.price_sale | money}}</div>\n                                                        </div>\n                                                        <div class="col actions">\n                                                            <a @click.stop.prevent="_onClick(item )" class="text-success"><i class="material-icons">add_box</i></a>\n                                                        </div>\n                                                    </div>\n                                                </template>\n                                        </div>\n                                    </template>\n                                    <template v-else>\n                                        <div  class="table-body">\n                                            <div class="text-center">\n                                                <h3 class="text-danger">Không tìm thấy dữ liệu</h3>\n                                            </div>\n                                        </div>\n                                    </template>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </template>\n                <template v-else>\n                    <div class="list-empty" >\n                        <div class="text-center">\n                            <i class="fas fa-exclamation-triangle"></i>\n                            <strong>Chưa có sản phẩm !</strong>\n                        </div>\n                    </div>\n                </template>\n            </div>\n            <div class="box-list-products-foot">\n                <div class="view-type">\n                    <a :class="{\'is-active\' : options.productView ==\'grid\'}" @click.stop.prevent="options.productView = \'grid\'" ><i class="material-icons">view_module</i></a>\n                    <a :class="{\'is-active\' : options.productView ==\'list\'}" @click.stop.prevent="options.productView = \'list\'" ><i class="material-icons">view_list</i></a>\n                </div>\n                <div class="view-filter">\n                    <label>\n                        <input type="checkbox" v-model="options.autoHideProduct"> Tự động ẩn khi hết món\n                    </label>\n                    &nbsp;&nbsp;\n                    <label>\n                        <input type="checkbox" v-model="options.chooseNumber"> Cho phép nhập số lượng\n                    </label>\n                </div>\n                <div class="view-sort hide">\n                    <select2 class="form-control" :options="states" v-model="options.productState"></select2>\n                </div>\n            </div>\n        </div>\n\t',props:{data:{},options:{},categories:{}},data:function(){return{states:[{_id:"all",text:"Tất cả"},{_id:"processing",text:"Có chế biến"},{_id:"nonprocessing",text:"Không chế biến"},{_id:"quantity",text:"Còn hàng"},{_id:"nonquantity",text:"Hết hàng"}]}},methods:{changeCategory:function(t){this.options.category!=t&&(this.options.category=t)},_onClick:function(t){var e=this;if(!e.options.loadingAddProduct)if(""!=e.options.activeTable)if(1==t.manage_inventory&&t.available_quantity<=0)$.dialog("<strong>Sản phẩm  này đang hết hàng !</strong>");else{var n=_.findIndex(e.$root.sources,{_id:e.options.activeTable});-1!=n&&(e.options.chooseNumber?e.$root.$refs.keyboard.show("",function(i){var s=parseInt(i);""!=s&&s>0&&(e.options.loadingAddProduct=!0,$.post("/admin/sales/pos/postAddProductToTable",{source_id:e.$root.sources[n]._id,product_id:t._id,quantity:s},function(t){if(403!=t.status)if(0==t.error){var i=_.findIndex(e.$root.sources[n].products,{_id:t.data._id});i>=0?e.$set(e.$root.sources[n].products,i,t.data):e.$root.sources[n].products.push(t.data),e.$nextTick(function(){e.$root.activeItemProduct(t.data._id,!0)}),t.hasOwnProperty("inventory")&&(e.$root.updateProductQuantity(t.inventory),socket.emit("pos_user_update_product_quantity",t.inventory))}else $.dialog(t.message)}).fail(function(){}).always(function(){e.options.loadingAddProduct=!1}))}):(e.options.loadingAddProduct=!0,$.post("/admin/sales/pos/postAddProductToTable",{source_id:e.$root.sources[n]._id,product_id:t._id,quantity:1},function(t){if(403!=t.status&&0==t.error){var i=_.findIndex(e.$root.sources[n].products,{_id:t.data._id});i>=0?e.$set(e.$root.sources[n].products,i,t.data):e.$root.sources[n].products.push(t.data),e.$nextTick(function(){e.$root.activeItemProduct(t.data._id,!0)}),t.hasOwnProperty("inventory")&&(e.$root.updateProductQuantity(t.inventory),socket.emit("pos_user_update_product_quantity",t.inventory))}}).fail(function(){}).always(function(){e.options.loadingAddProduct=!1})))}else $.dialog("<strong>Vui lòng chọn bàn trước khi thêm sản phẩm !</strong>")}},computed:{list:function(){var t=this,e=helper.convertCharacters(this.options.keywordProduct),n=0;return{data:t.data.filter(function(i){var s=!0,a=!0,o=!0;("all"!=t.options.category&&(s=i.category_id==t.options.category),t.options.autoHideProduct&&i.available_quantity<=0&&1==i.manage_inventory&&(o=!1),(i.available_quantity>0||0==i.manage_inventory)&&n++,""!=e)&&(a=helper.convertCharacters(i.name.toLowerCase()).indexOf(e)>=0);switch(t.options.state){case"processing":0==i.processing&&!1;break;case"nonprocessing":1==i.processing&&!1;break;case"quantity":1==i.manage_inventory&&0==i.available_quantity&&!1;break;case"nonquantity":1==i.manage_inventory&&i.available_quantity>0&&!1}return s&&o&&a}),active:n,total:t.data.length}}}}),Vue.component("tab-chiefs",{template:'\n\t<div class="box-chief">\n\t\t<div class="box-chief-left">\n            <div class="box">\n                <div class="box-header"></div>\n                <div class="box-body">\n                   <div v-if="listChiefs.length" class="list-waiting-chief" style="overflow: hidden auto">\n                        <ul class="list-group" >\n                            <li class="list-group-item item-chief" v-for="(item , index) in  listChiefs">\n                                <div class="item-image">\n                                    <template v-if="item.image == \'\'">\n                                        <img src="/resources/images/table/product.jpg">\n                                    </template>\n                                    <template v-else>\n                                        <img :src="item.image" alt="" class="img-responsive">\n                                    </template>\n                                    \n                                </div>\n                                <div class="item-info">\n                                    <div class="item-title"><strong>{{item.product_name }}</strong></div>\n                                    <div class="item-info-row">\n                                        <span class="icon">\n                                            <img src="/resources/images/table/table3.png" alt="">\n                                        </span>\n                                        <span class="value">{{ item.source_name}}</span>\n                                    </div>\n                                    \n                                    <div class="item-info-row">\n                                        <span class="icon">\n                                            <i class="far fa-clock"></i>\n                                        </span>\n                                        <timeago class="value" :time="item.updated_at"></timeago>\n                                    </div>\n                                </div>\n                                <div class="item-quantity">\n                                    <div class="mg-bottom-5">\n                                        <div class="status success">Đã làm :  <strong>{{ item.quantity}}</strong></div>\n                                    </div>\n                                    <div v-if="item.status == \'clear\'">\n                                        <div class="status danger">Đã hủy bàn</div>\n                                    </div>\n                                    <div v-else>\n                                        <div v-if="item.recive_quantity > 0" class="mg-bottom-5">\n                                            <div class="status warning">Đã cung ứng :<strong>{{ item.recive_quantity}}</strong></div>\n                                        </div>\n                                        <div v-if="item.hasOwnProperty(\'has_cancel\') && item.has_cancel > 0">\n                                            <div class="status danger">Đã hủy : <strong>{{ item.has_cancel}}</strong></div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div class="item-actions">\n                                    <template v-if="(item.quantity - item.recive_quantity) <= item.has_cancel">\n                                        <a class="btn btn-default btn-remove" @click.stop.prevent="removeItem(item._id , \'success\')">\n                                            <i class="material-icons text-danger">delete</i>\n                                        </a>\n                                    </template>\n                                    <template v-else>\n                                        <a  class="btn  btn-success" @click.stop.prevent="_increase(item._id )">\n                                            <i class="fas fa-chevron-right"></i>\n                                        </a>\n                                        <a  class="btn  btn-success" @click.stop.prevent="_increase(item._id , item.make_success - item.recive_quantity)">\n                                            <i class="fas fa-chevron-double-right"></i>\n                                        </a>\n                                    </template>\n                                </div>\n                            </li>\n                        </ul>\n                    </div>\n                    <div v-else class="box-empty" >\n                        <div class="box-empty-wrap">\n                            <p><i class="material-icons">shopping_basket</i></p> \n                            <p>Chưa có sản phẩm nào</p>\n                        </div>\n                    </div>\n                </div>\n                <div class="box-footer"></div>\n            </div>\n        </div>\n        <div class="box-chief-right">\n            <div class="box">\n                <div class="box-header">\n                    <div class="head-title">Nơi cung ứng</div>\n                    <div class="head-nav" >\n                        <ul class="nav nav-groups" >\n                            <li :class="{ active : group == \'all\'}">\n                                <a @click.stop.prevent="_changeGroup(\'all\')">Tất cả</a>\n                            </li>\n                            <li v-for="item in groups" :class="{ active : group ==  item._id}">\n                                <a @click.stop.prevent="_changeGroup(item._id)">{{item.name}}</a>\n                            </li>\n                        </ul>\n                    </div>\n                    <div class="head-form-search">\n                        <div class="form-group">\n                            <input type="text" class="form-control" v-model.trim="keyword" placeholder="Nhập từ khóa cần tìm ..." />\n                        </div>\n                    </div>\n                </div>\n                <div class="box-body">\n                   <div class="list-table-chiefs"  style="overflow: hidden auto">\n                     \n                            <div class="list-table-chiefs-wrap">\n                                <template v-for="(item , index ) in listSources">\n                                    <table-chief :active.sync="active" :table="item"></table-chief>\n                                </template>\n                            </div>\n                            \n                   </div>\n                </div>\n                <div class="box-footer"></div>\n            </div>\n        </div>\n\t</div>\t\n\t',props:{sources:{},data:{},options:{},user:{},groups:{}},data:function(){return{loading:!1,active:"",group:"all",navbar:"auto",keyword:""}},methods:{_changeGroup:function(t){this.group!=t&&(this.group=t)},_increase:function(t,e){var n=this;if(void 0!=t&&!this.loading&&-1!=_.findIndex(this.data,{_id:t})){var i=void 0==e?1:e;i<=0||$.post("/admin/sales/pos/postSuccessSupply",{_id:t,quantity:i},function(t){if(403!=t.status&&0==t.error){var e=_.findIndex(n.data,{_id:t.chief._id});e>=0&&n.$set(n.data,e,t.chief),t.hasOwnProperty("source_detail")&&n.$root.updateProductInSource(t.source_detail),socket.emit("pos_user_supply",{user:n.user,chief:{_id:t.chief._id,recive_quantity:t.chief.recive_quantity,updated_at:t.chief.updated_at}})}}).fail(function(){}).always(function(){n.loading=!1})}}},computed:{listChiefs:function(){var t=this,e=[],n=[],i=[];return t.data.forEach(function(t){var s,a=JSON.parse(JSON.stringify(t)),o=JSON.parse(JSON.stringify(t)),c=JSON.parse(JSON.stringify(t));if(0==t.cancel_quantity)a.has_cancel=0,o.has_cancel=0,c.has_cancel=0,0==t.make_success?0==t.waiting_make?(a.quantity=t.request_quantity,e.push(a)):(t.request_quantity>t.waiting_make&&(a.quantity=t.request_quantity-t.waiting_make,e.push(a)),o.quantity=t.waiting_make,n.push(o)):(t.request_quantity>t.waiting_make&&(a.quantity=t.request_quantity-t.waiting_make,e.push(a)),t.waiting_make>t.make_success&&(o.quantity=t.waiting_make-t.make_success,n.push(o)),c.quantity=t.make_success,i.push(c));else if(a.has_cancel=0,o.has_cancel=0,c.has_cancel=0,c.quantity=t.make_success,0==t.make_success)0==t.waiting_make?(a.quantity=t.request_quantity,a.has_cancel=t.cancel_quantity,e.push(a)):(s=t.request_quantity-t.waiting_make)>0?s==t.cancel_quantity?(a.quantity=s,a.has_cancel=s,e.push(a),o.has_cancel=0,o.quantity=t.waiting_make,n.push(o)):s>t.cancel_quantity?(a.quantity=s,a.has_cancel=t.cancel_quantity,e.push(a),o.quantity=t.waiting_make,o.has_cancel=0,n.push(o)):(a.quantity=s,a.has_cancel=s,e.push(a),o.quantity=t.waiting_make,o.has_cancel=t.cancel_quantity-s,n.push(o)):(o.quantity=t.waiting_make,o.has_cancel=t.cancel_quantity,n.push(o));else if(0==(s=t.request_quantity-t.waiting_make))o.quantity=t.waiting_make-t.make_success,t.cancel_quantity==t.waiting_make-t.make_success?o.has_cancel=t.cancel_quantity:t.cancel_quantity>t.waiting_make-t.make_success?(o.has_cancel=t.waiting_make-t.make_success,c.has_cancel=t.cancel_quantity-(t.waiting_make-t.make_success)):o.has_cancel=t.cancel_quantity,o.quantity>0&&n.push(o),i.push(c);else{if(a.quantity=t.request_quantity-t.waiting_make,t.cancel_quantity>=t.request_quantity-t.waiting_make?a.has_cancel=t.request_quantity-t.waiting_make:a.has_cancel=t.cancel_quantity,e.push(a),o.quantity=t.waiting_make-t.make_success,a.has_cancel<t.cancel_quantity){var l=t.cancel_quantity-a.has_cancel;t.waiting_make-t.make_success>=l?o.has_cancel=l:(o.has_cancel=t.waiting_make-t.make_success,c.has_cancel=l-o.has_cancel)}n.push(o),i.push(c)}}),i=i.filter(function(e){var n=!0;return""!=t.active&&e.source_id!=t.active&&(n=!1),e.quantity-e.recive_quantity>e.has_cancel&&n})},listSources:function(){var t=this,e=helper.convertCharacters(this.keyword.toLowerCase());return this.sources.filter(function(n){var i=!0,s=!0,a=!0,o=!0;return n.current_user!=t.user._id&&(s=!1),""!=n.relation_id&&(a=!1),"all"!=t.group&&t.group!=n.group_id&&(i=!1),""!=e&&-1==n.name_search.indexOf(e)&&(o=!1),s&&a&&o&&i})}},mounted:function(){}}),Vue.component("table-chief",{template:'\n        <div class="item-table " :class="{ \'is-active\' : active == table._id}" >\n            <div class="item-table-wrap" @click.stop.prevent="_onClick()">\n                <div class="item-table-name">{{table.name}}</div>\n                 <div class="item-table-icon">\n                    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAeCAYAAABe3VzdAAAACXBIWXMAAAsTAAALEwEAmpwYAAAF8GlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo2ZGE4MmIxMi0zZDhiLTkwNGUtOGQ5NC1mNWExYzBiNTZmZDUiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OTk3RjY2OUFDMTQ4MTFFODlBMTdEMTkzMkIzMTlBMUEiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MDk2ZjdiZTctZTljNi01NTQyLWIxNWItYTI4YTEwNDg1YjE4IiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDE4LTA5LTI2VDExOjU2OjU5KzA3OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOC0wOS0yNlQxMTo1OTo1OSswNzowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOC0wOS0yNlQxMTo1OTo1OSswNzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjEzNzVmZWNlLWNjMTEtYjg0MC04MDllLWRkMjBkMDM5OTZmYiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo2ZGE4MmIxMi0zZDhiLTkwNGUtOGQ5NC1mNWExYzBiNTZmZDUiLz4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MDk2ZjdiZTctZTljNi01NTQyLWIxNWItYTI4YTEwNDg1YjE4IiBzdEV2dDp3aGVuPSIyMDE4LTA5LTI2VDExOjU5OjU5KzA3OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pji//kwAAAEYSURBVFiF7ZWxSgNBEIa/EwmoTTwhRQQJmCoPk2aew0p8CkmlrzGND5PKQBC0EAx2Qpq1uF2Uc+9uj73gFvs1uxzD/h+7x0xhjCFljv5boIssGEsWjCV5weP6BxF5BcbAHjDACCgOkG1sRmEzPlX1slMQmNr19ABSdc5+7b15PsElcAI8ABPgFtgObQbMgBXwDtwAX76ioj5JRMRtn4Fr4ALYhaaqalCdiJTAB7BR1XlTXZPgCFhbwac+gj0oqV5rAyxUde8r8j2xw5kvBxZryvHSJuha0D3wNpjOD1Pgjo5W1yboWssj8BKa2uMfvKISbG1hIY36PCixP0HnJj9JsmAsWTCWLBjLn1mcGsnfYBaMJQvGkrzgN8iBNj3ZMh1GAAAAAElFTkSuQmCC"/>\n                </div>\n                <template v-if="table.state == \'booked\'">\n                    <div class="item-table-info text-center" v-html="info"></div>\n                </template>\n            </div>\n        </div>\n    ',props:{table:{},active:{}},methods:{_onClick:function(){this.active!=this.table._id?this.$emit("update:active",this.table._id):this.$emit("update:active","")}},computed:{info:function(){var t=0,e=0;return this.table.products.length?(this.table.products.forEach(function(n){t+=n.request_quantity,e+=n.recive_quantity}),"<strong>"+e+"</strong>/"+t+" món"):"Chưa chọn món"}}}),Vue.component("tab-booking",{template:'\n\t\t<div class="table-order-container-full table-order-booking">\n\t\t\t<template v-if="loader">\n\t\t\t\t<div class="box">\n\t\t\t\t\t<div class="box-loading" style="height:100%">\n\t                    <svg class="circular" viewBox="25 25 50 50">\n\t                        <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10" />\n\t                    </svg>\n\t                </div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<transition name="fade">\n\t            <div  v-if="!loader" class="box ">\n\t                <div class="box-header">\n\t                    <div class="box-header-left">\n\t                        <ul class="nav nav-groups">\n\t                            <li :class="{\'active\' : pagination.booking_status == \'all\'}">\n\t                                <a @click.stop.prevent="pagination.booking_status = \'all\'">Tất cả</a>\n\t                            </li>\n\t                            <li :class="{\'active\' : pagination.booking_status == \'wait\'}">\n\t                                <a @click.stop.prevent="pagination.booking_status = \'wait\'">Chưa nhận bàn</a>\n\t                            </li>\n\t                            <li :class="{\'active\' : pagination.booking_status == \'received\'}">\n\t                                <a @click.stop.prevent="pagination.booking_status = \'received\'">Đã nhận bàn</a>\n\t                            </li>\n\t                            <li :class="{\'active\' : pagination.booking_status == \'cancel\'}">\n\t                                <a @click.stop.prevent="pagination.booking_status = \'cancel\'">Đã hủy</a>\n\t                            </li>\n\t                        </ul>\n\t                    </div>\n\t                    <div class="box-header-right">\n\t                        <a @click.stop.prevent="_showModalCreate()" class="btn btn-success btn-block"><i class="fas fa-plus"></i>&nbsp; Thêm mới</a>\n\t                    </div>\n\t                </div>\n\t                <div class="box-body">\n\t                \t<div class="list-booking">\n\t\t\t\t\t\t\t<div class="list-booking-head">\n\t\t\t\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t\t\t\t<div class="col-xs-12 text-right">\n\t\t\t\t\t\t\t\t\t\t<div class="inline-block inline-title">\n\t\t\t\t\t\t\t\t\t\t\t<p>Tìm thấy <strong>{{pagination.total_records}}</strong> phiếu đặt bàn theo yêu cầu .</p>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="inline-block">\n\t\t\t\t\t\t\t\t\t\t\t<div class="keyword">\n\t\t\t\t\t\t\t\t\t\t\t\t<input type="text" v-model.trim="pagination.keyword" class="form-control" placeholder="Nhập từ khóa cần tìm ..." />\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="inline-block">\n\t\t\t\t\t\t\t\t\t\t\t<time-picker v-model="pagination.day"></time-picker>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="list-booking-body">\n\t\t\t\t\t\t\t\t<div class="table table-booking">\n\t\t\t\t\t\t\t\t\t<div class="table-head">\n\t\t\t\t\t\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t\t\t\t\t\t<div class="col index">#</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="col center">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="col customer">Khách hàng</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="col phone">Số điện thoại</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="col time">Giờ đặt</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="col number-customer">SL khách</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="col quantity">SL món</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="col detail">Chi tiết</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="col state">Trạng thái</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="col user">Nhân viên</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="col actions"></div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="table-body">\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t<template v-if="loading">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="box-loading" style="height:300px">\n\t\t\t\t\t                                <svg class="circular" viewBox="25 25 50 50">\n\t\t\t\t\t                                    <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10" />\n\t\t\t\t\t                                </svg>\n\t\t\t\t\t                            </div>\n\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t\t\t\t<template v-if="pagination.data.length">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="row" v-for="(item , index) in pagination.data">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="col index">{{(pagination.limit * (pagination.page - 1)) + index + 1}}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="col center">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="col customer">{{item.customer_name}}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="col phone">{{item.customer_phone}}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="col time">{{item.set_time  | full-time}}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="col number-customer">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span  class="status success">{{item.customer_quantity | money}} khách</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="col quantity">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span  class="status success">{{item.products.length | money}} món</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="col detail">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<template v-if="item.sources_name.length">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span v-for="(s , i) in item.sources_name">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{{s}}<template v-if="i < item.sources_name.length -1 ">, </template>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<template v-else>Chưa chọn bàn</template>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="col state">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span v-if="item.booking_status == \'wait\'"  class="status warning">Chờ nhận bàn</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span v-else-if="item.booking_status == \'cancel\'"  class="status danger">Đã hủy bàn</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span v-else-if="item.booking_status == \'received\'"  class="status success">Đã nhận bàn</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="col user">{{item.user_name}}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="col actions ">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<template v-if="item.booking_status == \'cancel\' || item.booking_status == \'received\'">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a  title="Thông tin đặt bàn" class="text-primary" @click.stop.prevent="_viewInfo(item._id)">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class="material-icons">info</i>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a  title="Thông tin đặt bàn" class="text-primary" @click.stop.prevent="_edit(item._id)">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class="material-icons">info</i>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a  title="Hủy đặt bàn" class="text-danger" @click.stop.prevent="_remove(item._id)">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class="material-icons">delete</i>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a  title="Xác nhận khách nhận bạn" class="text-success" @click.stop.prevent="_confirmBooking(item)">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class="material-icons">check_box</i>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<h3 class="text-center pd-30 text-danger no-mg">Không tìm thấy dữ liệu</h3>\n\t\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t                    </div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="list-booking-foot"></div>\n\t                \t</div>\n\t                    \n\t                </div>\n\t                <div class="box-footer">\n\t                \t<div class="limit-block">\n\t\t\t\t\t\t\t<select2 class="form-control" :options="limits" v-model="pagination.limit"></select2>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="pagination-block">\n\t\t\t\t\t\t\t<pagination :total="pagination.total" :current="pagination.page" :change="_changePage"></pagination>\n\t\t\t\t\t\t</div>\n\t                </div>\n\t            </div>\n            </transition>\n            <template v-if="show">\n\t            <div class="modal fade modal-booking"  ref="modal">\n\t\t\t\t    <div class="modal-dialog" role="document">\n\t\t\t\t        <div class="modal-content">\n\t\t\t\t            <div class="modal-header ">\n\t\t\t\t                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n\t\t\t\t            </div>\n\t\t\t\t            <div class="modal-body" >\n\t\t\t\t            \t<ul class="nav nav-tabs hide">\n\t\t\t\t\t\t\t\t\t<li :class="{\'active\' : create.tab == \'info\'}">\n\t\t\t\t\t\t\t\t\t\t<a @click.stop.prevent="create.tab =\'info\'" >Thông tin</a>\n\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t<li :class="{\'active\' : create.tab == \'product\'}">\n\t\t\t\t\t\t\t\t\t\t<a @click.stop.prevent="create.tab =\'product\'" >Sản phẩm</a>\n\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t            \t</ul>\n\t\t\t\t\t\t\t\t<ul class="stepy-header form-wizard-step">\n\t\t\t\t\t\t\t\t    <li @click.stop.prevent="_prevStep()" :disabled="step == \'info\'" class="stepy-btn ">\n\t\t\t\t\t\t\t\t        <div><i class="material-icons">arrow_back</i></div>\n\t\t\t\t\t\t\t\t        <span>Quay lại</span>\n\t\t\t\t\t\t\t\t    </li>\n\t\t\t\t\t\t\t\t    <li @click.stop.prevent="_changeStep(\'info\')" class="stepy-item  stepy-first" :class="{ \'stepy-active\' : step == \'info\'}">\n\t\t\t\t\t\t\t\t        <div>1</div>\n\t\t\t\t\t\t\t\t        <span>Thông tin chung</span>\n\t\t\t\t\t\t\t\t    </li>\n\t\t\t\t\t\t\t\t    <li @click.stop.prevent="_changeStep(\'product\')" class="stepy-item" :class="{ \'stepy-active\' : step == \'product\'}">\n\t\t\t\t\t\t\t\t        <div>2</div>\n\t\t\t\t\t\t\t\t        <span>Sản phẩm</span>\n\t\t\t\t\t\t\t\t    </li>\n\t\t\t\t\t\t\t\t    <li @click.stop.prevent="_changeStep(\'complete\')" class="stepy-item stepy-last" >\n\t\t\t\t\t\t\t\t        <div><i class="material-icons">done</i></div>\n\t\t\t\t\t\t\t\t        <span>Hoàn tất</span>\n\t\t\t\t\t\t\t\t    </li>\n\t\t\t\t\t\t\t\t    <li @click.stop.prevent="_nextStep()" class="stepy-btn">\n\t\t\t\t\t\t\t\t        <div><i class="material-icons">arrow_forward</i></div>\n\t\t\t\t\t\t\t\t        <span>Tiếp theo</span>\n\t\t\t\t\t\t\t\t    </li>\n\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t<div class="stepy-content">\n\t\t\t\t\t                <vue-form class="form-horizontal" :state="create.state" @submit.stop.prevent="_onSubmit()" v-if="step == \'info\'">\n\t\t\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t\t\t<label  class="col-sm-4 control-label">Thông tin KN <span class="text-danger">*</span></label>\n\t\t\t\t\t\t\t\t\t\t\t<div class="col-sm-8 form-search-customer">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="form-search-customer-wrap" ref="form_search_customer">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t<template v-if="_.has(create.customer , \'_id\')">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-customer">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<strong>{{create.customer.name | name}} - {{ create.customer.phone}}</strong>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a href="#" @click.stop.prevent="_removeCustomer()">chọn lại</a>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<suggestion \n\t\t\t\t\t                                        v-model="create.keywordCustomer" \n\t\t\t\t\t                                        :options="{debounce: 500  ,inputClass: \'form-control\' ,\'placeholder\' : \'Tìm khách hàng\'}"\n\t\t\t\t\t                                        :change="_changeCustomerSearch" \n\t\t\t\t\t                                        :select="_selectCustomerSearch"\n\t\t\t\t\t                                        class="customer-search-results" >\n\t\t\t\t\t                                        <template slot="item" scope="data" >\n\t\t\t\t\t                                            {{data.data.name | name}} - {{data.data.phone}}\n\t\t\t\t\t                                        </template>\n\t\t\t\t\t                                    </suggestion>\n\t\t\t\t\t                                    <div class="customer-search-btn">\n\t\t\t\t\t\t                                    <button class="btn btn-success" @click.stop.prevent="_createCustomer()">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class="fal fa-plus"></i>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<template v-if="!_.has(create.customer , \'_id\') && _.has(create.state , \'$submitted\')">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<code v-if="create.state.$submitted ==  true">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tChưa nhập tên khách hàng\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</code>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t\t\t<label  class="col-sm-4 control-label">Ngày đặt lịch : <span class="text-danger">*</span></label>\n\t\t\t\t\t\t\t\t\t\t\t<div class="col-sm-8">\n\t\t\t\t\t\t\t\t\t\t\t\t<time-picker :timepicker="true" name="set_time" v-model="create.set_time" placeholder="Chọn ngày đặt" ></time-picker>\n\t\t\t\t\t\t\t\t\t\t\t\t<validate name="set_time" >\n\t\t\t\t\t\t\t\t\t\t\t\t\t<input required v-model="create.set_time" name="set_time" hidden class="hide" />\n\t\t\t\t\t\t\t\t\t\t\t\t</validate>\n\t\t\t\t\t\t\t\t\t\t\t\t<field-messages name="set_time" show="$dirty || $submitted">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<code slot="required">Chưa chọn ngày đặt</code>\n\t\t\t\t\t\t\t\t\t\t\t\t</field-messages>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t\t\t<label  class="col-sm-4 control-label">Bàn đặt : <span class="text-danger">*</span></label>\n\t\t\t\t\t\t\t\t\t\t\t<div class="col-sm-8">\n\t\t\t\t\t\t\t\t\t\t\t\t<select2 :multiple="true" placeholder="Chọn bàn"  :options="sources" v-model="create.sources" class="form-control"> </select2>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t\t\t<label  class="col-sm-4 control-label">Số lượng khách : </label>\n\t\t\t\t\t\t\t\t\t\t\t<div class="col-sm-8">\n\t\t\t\t\t\t\t\t\t\t\t\t<input-spinner class="input-group-spinner" v-model="create.customer_quantity" :min="1"></input-spinner>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t\t\t<label  class="col-sm-4 control-label">Tiền tạm ứng : </label>\n\t\t\t\t\t\t\t\t\t\t\t<div class="col-sm-8">\n\t\t\t\t\t\t\t\t\t\t\t\t<item-keyboard class="form-control" v-model="create.deposit_cost"></item-keyboard>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t                </vue-form>\n\t\t\t\t\t                <div class="form-horizontal"  v-if="step == \'product\'">\n\t\t\t\t\t\t\t\t\t\t<div class="text-right mg-bottom-20">\n\t\t\t\t\t\t\t\t\t\t\t<button @click.stop.prevent="_chooseProduct()" class="btn btn-primary">Thêm sản phẩm</button>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="item-table item-table-choose-product">\n\t\t\t\t\t\t\t\t\t\t\t<div class="item-table-header">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-row">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-col item-index">#</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-col item-name">Sản phẩm</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-col item-quantity">Số lượng</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-col"></div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="item-table-body">\n\t\t\t\t\t\t\t\t\t\t\t\t<template v-if="create.products.length">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-row" v-for="(item , index) in create.products">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-col item-index">{{index + 1}}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-col item-name">{{item.name}}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-col item-quantity">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<input-spinner v-model="item.quantity" :min="1"></input-spinner>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-col item-action">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a href="#" class="text-danger" @click.stop.prevent="create.products.splice(index, 1)">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class="material-icons">delete</i>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="pd-20">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<h4 class="text-danger text-center"> Chưa có sản phẩm !</h4>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t                </div>\n\t\t\t\t\t            </div>\n\t\t\t\t            </div>\n\t\t\t\t        </div>\n\t\t\t\t    </div>\n\t\t\t\t</div>\n\t\t\t\t<div class="modal fade modal-booking"  ref="modalChooseProduct">\n\t\t\t\t    <div class="modal-dialog" role="document">\n\t\t\t\t        <div class="modal-content">\n\t\t\t\t            <div class="modal-header">\n\t\t\t\t                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n\t\t\t\t                <h4 class="modal-title">Chọn sản phẩm</h4>\n\t\t\t\t            </div>\n\t\t\t\t            <div class="modal-body">\n\t\t\t\t            \t<div class="row mg-bottom-20">\n\t\t\t\t\t\t\t\t\t<div class="col-xs-6">\n\t\t\t\t\t\t\t\t\t\t<label>Danh mục sản phẩm</label>\n\t\t\t\t\t\t\t\t\t\t<select2 v-model="filter.category" class="form-control" :options="filter.categories"></select2>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="col-xs-6">\n\t\t\t\t\t\t\t\t\t\t<label>Từ khóa</label>\n\t\t\t\t\t\t\t\t\t\t<div class="form-search">\n\t\t\t\t\t\t\t\t\t\t\t<input type="text" class="form-control" v-model="filter.keyword" placeholder="Nhập từ khóa ..." />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t            \t</div>\n\t\t\t\t            \t<div class="table table-modal-choose-product ">\n\t\t\t\t\t\t\t\t\t<div class="table-head">\n\t\t\t\t\t\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t\t\t\t\t\t<div class="col checked">&nbsp;</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="col index">#</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="col name">Sản phẩm</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="col quantity">Số lượng</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="table-body"  >\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t<div class="row" :class="{\'is-active\' : checkBox.indexOf(item._id) >= 0}" v-for="(item , index) in listProducts" @click="_onClickItem(item._id , $event )">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="col checked">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<input v-model="checkBox" type="checkbox" :value="item._id" />\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="col index">{{index + 1}}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="col name">{{item.name}}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="col quantity">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{{item.onhand_quantity}}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="text-right mg-top-20 mg-bottom-10">\n\t\t\t\t\t\t\t\t\t<a @click.stop.prevent="_onPushProduct()" class="btn btn-primary" :disabled="!checkBox.length">\n\t\t\t\t\t\t\t\t\t\t<i class="far fa-check"></i>&nbsp;&nbsp;Thêm <strong v-if="checkBox.length">{{checkBox.length}}</strong> sản phẩm đã chọn\n\t                                </a>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t            </div>\n\t\t\t\t        </div>\n\t\t\t\t    </div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-if="view.show">\n\t\t\t\t<div class="modal fade modal-booking"  ref="modalViewInfo">\n\t\t\t\t    <div class="modal-dialog" role="document">\n\t\t\t\t        <div class="modal-content">\n\t\t\t\t            <div class="modal-header ">\n\t\t\t\t                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n\t\t\t\t            </div>\n\t\t\t\t            <div class="modal-body" >\n\t\t\t\t                <div class="form-horizontal" >\n\t\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t\t<label  class="col-sm-4 control-label">Thông tin KN </label>\n\t\t\t\t\t\t\t\t\t\t<div class="col-sm-8 form-search-customer">\n\t\t\t\t\t\t\t\t\t\t\t<div class="form-search-customer-wrap" >\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-customer">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<strong>{{view.customer.name | name}} - {{ view.customer.phone}}</strong>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t\t<label  class="col-sm-4 control-label">Ngày đặt lịch :</label>\n\t\t\t\t\t\t\t\t\t\t<div class="col-sm-8">\n\t\t\t\t\t\t\t\t\t\t\t<input   class="form-control" v-model="view.set_time"  readonly/>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t\t<label  class="col-sm-4 control-label">Bàn đặt : </label>\n\t\t\t\t\t\t\t\t\t\t<div class="col-sm-8">\n\t\t\t\t\t\t\t\t\t\t\t<select2 :disabled="true" :multiple="true" placeholder="Chưa chọn bàn"  :options="sources" v-model="view.sources" class="form-control"> </select2>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t\t<label  class="col-sm-4 control-label">Số lượng khách : </label>\n\t\t\t\t\t\t\t\t\t\t<div class="col-sm-8">\n\t\t\t\t\t\t\t\t\t\t\t<input   class="form-control" v-model="view.customer_quantity"  readonly/>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t\t<label  class="col-sm-4 control-label">Tiền tạm ứng : </label>\n\t\t\t\t\t\t\t\t\t\t<div class="col-sm-8">\n\t\t\t\t\t\t\t\t\t\t\t<input   class="form-control" v-model="view.deposit_cost"  readonly/>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t\t<label  class="col-sm-4 control-label">Lý do hủy bàn : </label>\n\t\t\t\t\t\t\t\t\t\t<div class="col-sm-8">\n\t\t\t\t\t\t\t\t\t\t\t<textarea v-model="view.reason_cancel"  class="form-control" readonly ></textarea>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t\t<div class="item-table item-table-choose-product" v-if="view.products.length">\n\t\t\t\t\t\t\t\t\t\t\t<div class="item-table-header">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-row">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-col item-index">#</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-col item-name">Sản phẩm</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-col item-quantity">Số lượng</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-col"></div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="item-table-body">\n\t\t\t\t\t\t\t\t\t\t\t\t<template v-if="view.products.length">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-row" v-for="(item , index) in view.products">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-col item-index">{{index + 1}}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-col item-name">{{item.name}}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-col item-quantity">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="status success">{{item.quantity}}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t                </div>\n\t\t\t\t            </div>\n\t\t\t\t        </div>\n\t\t\t\t    </div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-if="confirm.show">\n\t\t\t\t<modal-confirm-booking  :confirm.sync="confirm" :reload="_load" ></modal-confirm-booking>\n\t\t\t</template>\n        </div>\n\t',props:{options:{},products:{},sources:{},categories:{}},data:function(){return{limits:[{id:10,text:10},{id:20,text:20},{id:30,text:30},{id:50,text:50},{id:100,text:100}],pagination:{limit:10,page:1,data:[],booking_status:"all",status:"publish",total:0,total_records:0,day:parseInt((new Date).getTime()/1e3),keyword:""},show:!1,create:{keywordCustomer:"",state:{},customer:"",tab:"info",name:"",phone:"",set_time:"",customer_quantity:1,deposit_cost:"",products:[],sources:[],mode:"create"},view:{customer:"",set_time:"",customer_quantity:"",deposit_cost:"",products:"",sources:"",reason_cancel:"",show:!1},confirm:{show:!1,_id:"",sources:[],selected:[]},loadingConfirm:!1,loading:!1,loader:!0,step:"info",checkBox:[],timeout:null,filter:{category:"",keyword:"",categories:[]}}},methods:{_load:function(){var t=this;this.loading||(this.loading=!0,$.post("/admin/sales/pos/postLoadBookList",{page:this.pagination.page,status:this.pagination.status,booking_status:this.pagination.booking_status,keyword:this.pagination.keyword,day:this.pagination.day,limit:this.pagination.limit},function(e){403!=e.status&&0==e.error&&(t.pagination.data=e.data,t.pagination.limit=e.limit,t.pagination.total=e.total,t.pagination.total_records=e.total_records,t.loader&&(t.loader=!1))}).fail(function(){}).always(function(){t.loading=!1}))},_changePage:function(t){this.pagination.page=t,this._load()},_viewInfo:function(t){var e=this;$.post("/admin/sales/pos/getUpdateBookingTable",{_id:t},function(t){if(console.log(t),403!=t.status&&0==t.error){var n=moment(new Date(1e3*t.booking.set_time)).format("HH:mm DD/MM/YYYY");e.view={customer:t.booking.customer,set_time:n,customer_quantity:t.booking.customer_quantity,deposit_cost:t.booking.deposit_cost,products:t.booking.products,sources:t.booking.sources,reason_cancel:t.booking.reason_cancel,show:!0},e.$nextTick(function(){var t=this;$(this.$refs.modalViewInfo).modal("show"),$(this.$refs.modalViewInfo).on("hidden.bs.modal",function(){t.view={customer:"",set_time:"",customer_quantity:"",deposit_cost:"",products:"",sources:"",reason_cancel:"",show:!1}})})}}).fail(function(){}).always(function(){})},_edit:function(t){var e=this;$.post("/admin/sales/pos/getUpdateBookingTable",{_id:t},function(n){console.log(n),403!=n.status&&0==n.error&&(e.create={state:{},keywordCustomer:"",_id:t,customer:n.booking.customer,set_time:n.booking.set_time,customer_quantity:n.booking.customer_quantity,deposit_cost:n.booking.deposit_cost,products:n.booking.products,sources:n.booking.sources,mode:"edit"},e.show=!0,e.$nextTick(function(){var t=this;$(this.$refs.modal).modal("show"),$(this.$refs.modal).on("hidden.bs.modal",function(){t.create={state:{},keywordCustomer:"",tab:"info",customer:"",set_time:"",customer_quantity:1,deposit_cost:"",products:[],sources:[],mode:"create"},t.show=!1}),$(this.$refs.modalChooseProduct).on("hidden.bs.modal",function(){$(t.$refs.modal).addClass("in"),$("body").addClass("modal-open")})}))}).fail(function(){}).always(function(){})},_remove:function(t){var e=this,n=!0,i=$.confirm({title:"",content:'\n\t\t\t\t\t<form >\n\t\t\t\t\t\t<div class="text-center "><h4 class="mg-top-0 mg-bottom-10">Hủy bàn đã đặt</h4></div>\n\t\t\t\t\t\t<label>Lý do</label>\n\t\t\t\t\t\t<textarea class="form-control" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>\n\t\t\t\t\t</form>\n                ',type:"green",backgroundDismiss:function(){return"backdrop"},buttons:{backdrop:{isHidden:!0,action:function(){return n}},formSubmit:{text:"Đồng ý",btnClass:"btn-success",action:function(){var s=i.$content.find("textarea").val().trim();return""==s?($.dialog("Chưa nhập lý do hủy bàn"),!1):(n=!1,i.showLoading(!0),new Promise(function(n,i){$.post("/admin/sales/pos/postCancelBookingList",{_id:t,reason:s},function(t){403!=t.status&&0==t.error&&(e._load(),n(!0))}).fail(function(){n(!1)}).always(function(){})}))}},close:{text:"Đóng",btnClass:"btn-default"}},onContentReady:function(){var t=this;this.$content.find("form").on("submit",function(e){e.preventDefault(),t.$$formSubmit.trigger("click")}),this.$content.find("textarea").focus()}})},_confirmBooking:function(t){var e=this;$.post("/admin/sales/pos/getUpdateBookingTable",{_id:t._id},function(t){if(403!=t.status&&0==t.error){console.log(t),e.confirm={_id:t.booking._id,sources:[],selected:[],products:t.booking.products,customer:t.booking.customer,show:!0};var n=!0,i=[],s=""==t.booking.sources||null==t.booking.sources?[]:t.booking.sources;if(e.sources.forEach(function(t){s.indexOf(t._id)>=0&&(e.confirm.sources.push(t),("booked"==t.state||null!=t.relation_id&&""!=t.relation_id)&&(n=!1,i.push(t)))}),0==n){var a="Hiện tại ";i.forEach(function(t,e){a+=e>0?", "+t.name:t.name}),a+=" đang có khách . Vui lòng thanh toán hoặc chọn bàn khác !"}else e.confirm.sources.length&&(e.confirm.selected=JSON.parse(JSON.stringify(e.confirm.sources)));e.$nextTick(function(){0==n&&setTimeout(function(){$.dialog(a)},500)})}}).fail(function(){}).always(function(){})},_showModalCreate:function(){this.show=!0,this.$nextTick(function(){var t=this;$(this.$refs.modal).modal("show"),$(this.$refs.modal).on("hidden.bs.modal",function(){t.step="info",t.show=!1,t.create={state:{},keywordCustomer:"",customer:"",set_time:"",customer_quantity:1,deposit_cost:"",products:[],sources:[],mode:"create"}}),$(this.$refs.modalChooseProduct).on("hidden.bs.modal",function(){$(t.$refs.modal).addClass("in"),$("body").addClass("modal-open")})})},_changeCustomerSearch:function(t){return 0===t.trim().length?null:(t=(t=helper.convertCharacters(t)).toLowerCase(),new Promise(function(e){$.post("/admin/sales/pos/postFindCustomersByPhoneOrName",{keyword:t},function(t){403!=t.status&&0==t.error&&e(t.data)}).fail(function(){}).always(function(){})}))},_selectCustomerSearch:function(t){this.create.customer=t},_createCustomer:function(){var t=this;this.$root.createCustomer(function(e){t._selectCustomerSearch(e)})},_removeCustomer:function(){this.create.customer=null,this.$nextTick(function(){$(this.$refs.form_search_customer).find("input").select()})},_onSubmit:function(){this.create.$valid},_nextStep:function(){var t=this;"info"==this.step?this._validate().then(function(e){1==e&&(t.step="product")}):"product"==this.step&&this._validate().then(function(e){1==e&&t._complete()})},_validate:function(){var t=this;return new Promise(function(e,n){t.create.state.$submitted=!0,t.create.state.$valid&&_.has(t.create,"customer._id")?e(!0):e(!1)})},_prevStep:function(){"product"==this.step&&(this.step="info")},_changeStep:function(t){var e=this;"info"==t?this.step="info":"product"==t?this._validate().then(function(t){1==t&&(e.step="product")}):"complete"==t&&this._validate().then(function(t){1==t&&e._complete()})},_complete:function(){var t=this;this._validate().then(function(e){if(1==e){var n="",i="",s={customer_id:t.create.customer._id,set_time:t.create.set_time,customer_quantity:t.create.customer_quantity,sources:t.create.sources,deposit_cost:t.create.deposit_cost,products:t.create.products,warehouse_id:t.$root.warehouse_id};"edit"==t.create.mode?(s._id=t.create._id,i="/admin/sales/pos/postUpdateBookingTable",n="<h4>Bạn có muốn cập nhật phiếu đặt bàn  ?</h4>"):(n="<h4>Bạn có muốn tạo phiếu đặt bàn  ?</h4>",i="/admin/sales/pos/postCreateBookingTable"),$.confirm({title:"",content:n,buttons:{save:{text:"Đồng ý",btnClass:"btn-success",action:function(){t.$root.showLoader(),$.post(i,s,function(e){403!=e.status&&0==e.error&&(t._load(),$(t.$refs.modal).modal("hide"))}).fail(function(){}).always(function(){t.$root.closeLoader(500)})}},close:{text:"Đóng",btnClass:"btn-default"}}})}})},checkDate:function(t){return""==t||null==t},_chooseProduct:function(){this.checkBox=[],$(this.$refs.modal).removeClass("in"),$(this.$refs.modalChooseProduct).modal("show")},_onPushProduct:function(){var t=this;this.checkBox.length&&(this.products.forEach(function(e){var n=e._id;t.checkBox.indexOf(n)>=0&&(-1==_.findIndex(t.create.products,{_id:n})&&t.create.products.push({_id:e._id,quantity:1,name:e.name}))}),$(this.$refs.modalChooseProduct).modal("hide"))},_onClickItem:function(t,e){var n=e.target.tagName.toLowerCase();if("a"!=n&&"i"!=n&&"span"!=n&&"input"!=n){var i=this.checkBox.indexOf(t);-1==i?this.checkBox.push(t):this.checkBox.splice(i,1)}}},watch:{"pagination.keyword":function(t){var e=this;clearTimeout(this.timeout),this.timeout=setTimeout(function(){1!=e.pagination.page&&(e.pagination.page=1),e._load()},1e3)},"pagination.day":function(t){1!=this.pagination.page&&(this.pagination.page=1),this._load()},"pagination.limit":function(t){1!=this.pagination.page&&(this.pagination.page=1),this._load()},"pagination.status":function(t){1!=this.pagination.page&&(this.pagination.page=1),this._load()},"pagination.booking_status":function(t){1!=this.pagination.page&&(this.pagination.page=1),this._load()}},computed:{listProducts:function(){var t=this,e=helper.convertCharacters(_.trim(this.filter.keyword)).toLowerCase();return this.products.filter(function(n){var i=!0,s=!0;""!=e&&(-1==helper.convertCharacters(_.trim(n.name)).toLowerCase().indexOf(e)&&(i=!1));return"all"!=t.filter.category&&""!=t.filter.category&&null!=t.filter.category&&n.category_id!=t.filter.category&&(s=!1),i&&s})}},created:function(){this.filter.categories=JSON.parse(JSON.stringify(this.categories)),this.filter.categories.unshift({_id:"all",text:"Tất cả danh mục"})},mounted:function(){this._load()}}),Vue.component("input-spinner",{template:'\n\t\t<div class="input-group">\n\t\t\t<span class="input-group-btn">\n\t\t\t\t<button @click.stop.prevent="_decrease()" class="btn btn-default" type="button"><i class="fal fa-minus"></i></button>\n\t\t\t</span>\n\t\t\t<div class="form-control"  @click.stop.prevent="_onkeyboard()">\n\t\t\t\t{{num | money}}\n\t\t\t</div>\n\t\t\t<span class="input-group-btn">\n\t\t\t\t<button  @click.stop.prevent="_increase()" class="btn btn-default" type="button"><i class="fal fa-plus"></i></button>\n\t\t\t</span>\n\t\t</div>\n\t',props:{value:{},max:{default:999999999999},min:{default:0}},data:function(){return{num:this.value}},methods:{_increase:function(){this.num<this.max&&(this.num+=1)},_decrease:function(){this.num>this.min&&(this.num-=1)},_onkeyboard:function(){var t=this;this.$root.$refs.keyboard.show(this.num,function(e){parseInt(e)>t.min&&(t.num=parseInt(e))},this.max)}},watch:{num:function(t){this.$emit("input",t)},value:function(t){this.num!=t&&(this.num=t)}}}),Vue.component("item-keyboard",{template:'<span @click.stop.prevent="_onClick">{{value | money}}</span>',props:{value:{}},data:function(){return{}},methods:{_onClick:function(){var t=this;this.$root.$refs.keyboard.show(this.value,function(e){parseInt(e)>0&&t.$emit("input",e)})}}}),Vue.component("modal-confirm-booking",{template:'\n\t\t<div class="modal fade modal-confirm-booking"  >\n\t\t    <div class="modal-dialog" role="document">\n\t\t        <div class="modal-content">\n\t\t            <div class="modal-body" >\n\t\t            \t<div class="box">\n\t\t            \t\t<template v-if="filter.tab == \'source\'">\n\t\t\t\t\t\t\t\t<div class="box-head">\n\t\t\t\t\t\t\t\t\t<div class="box-head-left">\n\t\t\t\t\t\t\t\t\t\t<ul class="nav nav-groups" >\n\t\t\t\t\t                        <li :class="{ active : filter.group == \'all\'}">\n\t\t\t\t\t                            <a @click.stop.prevent="changeGroup(\'all\')">Tất cả</a>\n\t\t\t\t\t                        </li>\n\t\t\t\t\t                        <li v-for="item in $root.groups" :class="{ active : filter.group ==  item._id}">\n\t\t\t\t\t                            <a @click.stop.prevent="changeGroup(item._id)">{{item.name}}</a>\n\t\t\t\t\t                        </li>\n\t\t\t\t\t                    </ul>\n\t\t\t\t                    </div>\n\t\t\t\t                    <div class="box-head-right">\n\t\t\t\t\t\t\t\t\t\t<div class="form-search">\n\t\t\t\t\t\t\t\t\t\t\t<input type="text" class="form-control" placeholder="Nhập từ khóa cần tìm" v-model.trim="filter.keywordSource" />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t                    </div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="box-body">\n\t\t\t\t\t\t\t\t\t<div class="list-tables-wrapper" >\n\t\t\t\t\t\t\t\t\t\t<template v-if="filterSources.length">\n\t\t\t\t\t\t\t\t\t\t\t<template v-for="(table, index) in filterSources">\n\t\t\t\t                                <div class="item_table" :class="_class(table)" @click.stop.prevent="_onClick(table)">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item_table_wrap">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img :src="$root.images.square" class="item_table_grid" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item_table_name">{{table.name}}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t                                </div>\n\t\t\t\t                            </template>\n\t\t\t                            </template>\n\t\t\t                            <template v-else>\n\t\t\t\t\t\t\t\t\t\t\t<div class="text-center pd-50">\n\t\t\t\t\t\t\t\t\t\t\t\t<h3>Không tìm thấy dữ liệu </h3>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t                            </template>\n\t\t\t\t                \t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else-if="filter.tab == \'product\'">\n\t\t\t\t\t\t\t\t<div class="box-body-product">\n\t\t\t\t\t\t\t\t\t<div class="box-body-product-left">\n\t\t\t\t\t\t\t\t\t\t<div class="panel">\n\t\t\t\t\t\t\t\t\t\t\t<div class="panel-head">\n\t\t\t\t\t\t\t\t\t\t\t\t<ul class="nav nav-groups" >\n\t\t\t\t\t\t\t                        <li :class="{ active : filter.category == \'all\'}">\n\t\t\t\t\t\t\t                            <a @click.stop.prevent="changeCategory(\'all\')">Tất cả</a>\n\t\t\t\t\t\t\t                        </li>\n\t\t\t\t\t\t\t                        <li v-for="item in $root.categories" :class="{ active : filter.category ==  item._id}">\n\t\t\t\t\t\t\t                            <a @click.stop.prevent="changeCategory(item._id)">{{item.name}}</a>\n\t\t\t\t\t\t\t                        </li>\n\t\t\t\t\t\t\t                    </ul>\n\t\t\t\t\t\t\t                    <div class="form-search">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<input type="text" class="form-control" v-model.trim="filter.keywordProduct" placeholder="Nhập từ khóa cần tìm .."/>\n\t\t\t\t\t\t\t                    </div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="panel-body">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="list-wrap"  style="overflow: hidden auto">\n\t\t\t                                        <div class="list-products" v-if="filterProducts.length">\n\t\t\t                                            <div class="item-product" v-for="(item, index) in filterProducts" >\n\t\t\t                                                <div class="item-product-wrap">\n\t\t\t                                                    <div class="item-product-quantity" v-if="item.manage_inventory">\n\t\t\t                                                        <div class="badge">{{item.available_quantity}}</div>\n\t\t\t                                                    </div>\n\t\t\t                                                    <div class="item-product-image">\n\t\t\t                                                        <img :src="$root.images.square" class="item-product-grid" />\n\t\t\t                                                        <template v-if="_.has(item ,\'image.path\')">\n\t\t\t                                                            <div class="item-product-image-wrap">\n\t\t\t                                                                <img :src="\'/\'+item.image.path" class="img-responsive" />\n\t\t\t                                                            </div>\n\t\t\t                                                        </template>\n\t\t\t                                                        <template v-else>\n\t\t\t                                                            <div class="item-product-image-wrap empty">\n\t\t\t                                                                <i class="material-icons">\n\t\t\t                                                                    camera\n\t\t\t                                                                </i>\n\t\t\t                                                            </div>\n\t\t\t                                                        </template>\n\t\t\t                                                    </div>\n\t\t\t                                                    <div class="item-product-title">\n\t\t\t                                                        {{item.name}}\n\t\t\t                                                    </div>\n\t\t\t                                                    <div class="item-product-price">\n\t\t\t                                                        {{item.price_sale | money}}\n\t\t\t                                                    </div>\n\t\t\t                                                </div>\n\t\t\t                                            </div>\n\t\t\t                                        </div>\n\t\t\t                                        <div class="box-empty" v-else>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="box-empty-wrap">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p><i class="material-icons">shopping_basket</i></p> \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p>Chưa có sản phẩm nào</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t                                </div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="box-body-product-right">\n\t\t\t\t\t\t\t\t\t\t<div class="panel">\n\t\t\t\t\t\t\t\t\t\t\t<div class="panel-head">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="panel-head-left">\n\t\t\t\t\t\t\t\t\t\t\t\t\tSản phẩm đã chọn {{confirm.products.length}}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="panel-head-right">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="form-search">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<input type="text" class="form-control" v-model="filter.keywordProduct2" placeholder="Nhập từ khóa cần tìm ..."/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="panel-body">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="list-wrap"  style="overflow: hidden auto">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<template v-if="listProductSelected.length">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-product-selected" v-for="(item, index) in listProductSelected" :key="item._id">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-info">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-image">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<template v-if="item.image != \'\'">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img :src="\'/\'+item.image" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-content">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<strong>{{item.name}}</strong>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<template v-if="_.has(item , \'product._id\')">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p  v-if="item.product.manage_inventory">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSố lượng còn : {{item.product.onhand_quantity}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<item-spinner :id="item._id" v-model="item.quantity"></item-spinner>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-info item-actions" >\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="status info" v-once>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tĐặt trước : {{item.quantity}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<template v-if="_.has(item , \'product._id\')">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span v-if="item.product.manage_inventory && item.quantity > item.product.onhand_quantity"  class="status warning" >\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tKhông đủ số lượng\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a @click.stop.prevent="_remove(item._id)" class="btn btn-danger">Hủy món</a>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="box-empty">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="box-empty-wrap">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p><i class="material-icons">shopping_basket</i></p> \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p>Chưa có sản phẩm nào</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<div class="box-foot">\n\t\t\t\t\t\t\t\t<div class="box-foot-left">\n\t\t\t\t\t\t\t\t\t<div class="customer" >\n\t\t\t\t\t\t\t\t\t\t<label>khách hàng</label>\n\t\t\t\t\t\t\t\t\t\t<span  >\n\t\t\t\t\t\t\t\t\t\t\t<template v-if="_.has(confirm , \'customer.name\')">\n\t\t\t\t\t\t\t\t\t\t\t\t{{confirm.customer.name}}\n\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t\t- \n\t\t\t\t\t\t\t\t\t\t\t<template v-if="_.has(confirm , \'customer.phone\')">\n\t\t\t\t\t\t\t\t\t\t\t\t{{confirm.customer.phone}}\n\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t<template v-if="confirm.selected.length">\n\t\t\t\t\t\t\t\t\t\t\t<button v-for="item  in confirm.selected" class="btn btn-success">{{item.name}}</button>\n\t\t\t\t                \t\t</template>\n\t\t\t\t                \t\t<a  v-if="filter.tab == \'product\'" @click.stop.prevent="filter.tab =\'source\'">\n\t\t\t\t\t\t\t\t\t\t\tChọn lại\n\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="box-foot-right">\n\t\t\t\t\t\t\t\t\t<a class="btn btn-primary" v-if="filter.tab == \'source\'" @click.stop.prevent="filter.tab =\'product\'">\n\t\t\t\t\t\t\t\t\t\tChọn món\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t<a  class="btn btn-success" @click.stop.prevent="_save()">\n\t\t\t\t\t\t\t\t\t\tXác nhận khách vào bàn\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t            \t</div>\n\t\t            </div>\n\t\t        </div>\n\t\t    </div>\n\t\t</div>\n\t',props:{confirm:{},reload:{}},data:function(){return{loading:!1,filter:{group:"all",keywordSource:"",keywordProduct:"",keywordProduct2:"",category:"all",tab:"source"},products:[]}},methods:{_class:function(t){return""!=t.relation_id&&null!=t.relation_id?"booked":_.findIndex(this.confirm.selected,{_id:t._id})>=0?"is-active":"booked"==t.state?"booked":"wait"==t.state?"wait":void 0},_onClick:function(t){if("booked"!=t.state&&(null==t.relation_id||""==t.relation_id)){var e=_.findIndex(this.confirm.selected,{_id:t._id});e>=0?this.confirm.selected.splice(e,1):this.confirm.selected.push(t)}},_save:function(){var t=this;0!=this.confirm.selected.length?this.$root.comfirm("Xác nhận !","Xác nhận khách nhận bàn ?",{save:{text:"Xác nhận",btnClass:"btn-success",keys:["enter"],action:function(){t.$root.showLoader(),$.post("/admin/sales/pos/postConfirmBookingList",{booking_id:t.confirm._id,sources:t.confirm.selected,products:t.confirm.products},function(e){if(403!=e.status)if(0==e.error){if(e.hasOwnProperty("data_merge")&&e.data_merge.hasOwnProperty("source")){var n=e.data_merge.source,i={},s=[];e.hasOwnProperty("data_inventory")&&e.data_inventory.length&&(e.data_inventory.forEach(function(t){if(t.hasOwnProperty("detail")&&n.products.push(t.detail),t.hasOwnProperty("inventory"))for(var e in t.inventory)i[e]=t.inventory[e]}),t.$root.updateProductQuantity(i),socket.emit("pos_user_update_product_quantity",i)),e.data_merge.hasOwnProperty("target")&&e.data_merge.target.length&&e.data_merge.target.forEach(function(t){s.push(t._id)}),t.$root.updateSource({source:n,relation:s,update_product_quantity:i})}$(t.$el).modal("hide"),"function"==typeof t.reload&&t.reload()}else helper.dialog(e.message,"warning","warning",1e3)}).fail(function(){}).always(function(){t.$root.closeLoader(500)})}},close:{text:"Đóng",btnClass:"btn-default",keys:["esc"]}}):$.dialog("Chưa chọn bàn !")},changeGroup:function(t){this.filter.group!=t&&(this.filter.group=t)},changeCategory:function(t){this.filter.category!=t&&(this.filter.category=t)},_remove:function(t){var e=this;$.confirm({title:"Xác nhận",content:"Bạn có muốn hủy món này ?",buttons:{save:{text:"Đồng ý",btnClass:"btn-success",action:function(){var n=_.findIndex(e.confirm.products,{_id:t});n>=0&&e.confirm.products.splice(n,1)}},close:{text:"Đóng",btnClass:"btn-default"}}})}},computed:{filterSources:function(){var t=this,e=helper.convertCharacters(_.trim(this.filter.keywordSource.toLowerCase()));return this.$root.sources.filter(function(n){var i=!0,s=!0;return"all"!=t.filter.group&&n.group_id!=t.filter.group&&(s=!1),""!=e&&(i=n.name_search.indexOf(e)>=0),(""==n.state||"empty"==n.state)&&i&&s})},filterProducts:function(){var t=this,e=helper.convertCharacters(_.trim(this.filter.keywordProduct.toLowerCase()));return this.$root.products.filter(function(n){var i=!0,s=!0;("all"!=t.filter.category&&n.category_id!=t.filter.category&&(s=!1),""!=e)&&(i=helper.convertCharacters(_.trim(n.name.toLowerCase())).indexOf(e)>=0);return i&&s})},listProductSelected:function(){var t=helper.convertCharacters(_.trim(this.filter.keywordProduct2.toLowerCase()));return this.confirm.products.filter(function(e){var n=!0;""!=t&&(n=helper.convertCharacters(_.trim(e.name.toLowerCase())).indexOf(t)>=0);return n})}},components:{"item-spinner":{template:'\n\t\t\t\t<div class="item-spinner">\n\t\t\t\t\t<button class="btn btn-default" type="button" @click.stop.prevent="_decrease()">-</button>\n\t\t\t\t\t<span class="form-control" >{{value}}</span>\n\t\t\t\t\t<button class="btn btn-default" type="button" @click.stop.prevent="_increase()">+</button>\n\t\t\t\t</div>\n\t\t\t',props:{value:{},id:{}},data:function(){return{min:1,max:999999}},methods:{_increase:function(){this.value<this.max&&this.$emit("input",this.value+1)},_decrease:function(){this.value>this.min&&this.$emit("input",this.value-1)}},created:function(){var t=_.find(this.$root.products,{_id:this.id});void 0!=t&&(this.max=t.onhand_quantity)}}},created:function(){var t=this;this.confirm.products=this.confirm.products.map(function(e){return e.product=_.find(t.$root.products,{_id:e._id}),e})},mounted:function(){var t=this;$(this.$el).modal("show"),$(this.$el).on("hidden.bs.modal",function(){t.$emit("update:confirm",{_id:"",sources:[],show:!1,selected:[]})})}}),Vue.component("source-detail",{template:'\n        <div class="source-detail">\n            <div class="source-detail-head">\n                <div class="head-title">\n                    <strong>{{name}}</strong>\n                </div>\n                <div class="head-btn-groups">\n                    <div class="btn-group">\n                        <button type="button" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n                            <i class="fas fa-ellipsis-v"></i>\n                        </button>\n                        <ul class="dropdown-menu dropdown-menu-right">\n                            <li><a @click="$root.showModalSwitchTable(data._id)">Chuyển bàn</a></li>\n                            <li><a @click="$root.showModalJoinTable(data._id)">Gộp bàn</a></li>\n                            <li><a @click="$root.clearTable(data._id)">Hủy bàn</a></li>\n                            <li><a @click="$root.config.activeTable = \'\'">Đóng</a></li>\n                        </ul>\n                    </div>\n                </div>\n            </div>\n            <div class="source-detail-body" :class="{ \'has-alert\' : tables.alert }" >\n                <div class="list-product-order" style="overflow: hidden scroll">\n                    <div class="list-product-order-wrap " id="listProductSources" ref="list" >\n                        <template v-for="(item , index) in data.products" >\n                            <item-product :id="item._id" :options="options" :source="data" :item.sync="item" :index="index"></item-product>\n                        </template>\n                    </div>\n                    <div class="list-product-order-empty" v-if="!data.products.length">\n                        <i class="fas fa-shopping-basket"></i>\n                        <span>Chưa có sản phẩm nào</span>\n                    </div>\n                </div>\n                <template v-if="tables.alert && options.use_bartender ">\n                    <div class="item-alert" role="alert">\n                        <i class="material-icons">notifications_active</i>&nbsp;Bạn vừa cập nhật thêm đơn hàng !. Click <strong>"Báo bếp"</strong> để đồng bộ đơn hàng với bếp !\n                    </div>\n                </template>\n            </div>\n            <div class="source-detail-foot">\n                <div class="customer">\n                    <div class="customer-search">\n                        <template v-if="_.has(data , \'customer._id\')">\n                            <div class="item-customer">\n                                <a href="#" @click.stop.prevent="_removeCustomer()"><i class="fal fa-times"></i></a>\n                                {{data.customer.name | name }} - {{data.customer.phone }}\n                            </div>\n                        </template>\n                        <template v-else>\n                            <suggestion \n                                ref="inputCustomer"\n                                v-model="keywordCustomer" \n                                :options="{debounce: 500  ,inputClass: \'form-control\' ,\'placeholder\' : \'Tìm khách hàng\'}"\n                                :change="_changeCustomerSearch" \n                                :select="_selectCustomerSearch"\n                                class="customer-search-results" >\n                                <template slot="item" scope="data" >\n                                    {{data.data.name | name}} - {{data.data.phone}}\n                                </template>\n                            </suggestion>\n                        </template>\n                        <a @click.stop.prevent="_onSubmitCreateCustomer()" class="btn btn-success btn-create-customer"><i class="fas fa-plus"></i></a>\n                    </div>\n                    <div class="customer-note">\n                        <a href="#" @click.stop.prevent="_showNote()">\n                            <i class="material-icons">edit</i>&nbsp;Ghi chú <span v-if="data.note != \'\'"> : {{data.note}}</span> \n                        </a> \n                    </div>\n                    \n                </div>\n                <div class="order-info">\n                    <div class="summary">\n                        <div class="row">\n                            <div class="col-xs-12 summary-title">\n                                Tổng cộng\n                            </div>\n                            <div class="col-xs-12 summary-value">\n                                <span>{{tables.summary | money}}</span>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="discount">\n                        <div class="row">\n                            <div class="col-xs-12 discount-title">\n                                Giảm giá\n                            </div>\n                            <div class="col-xs-12 discount-value">\n                                <money  class="form-control form-control-discount" :max="tables.summary"  v-model="data.discount_value"></money>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="total">\n                        <div class="row">\n                            <div class="col-xs-12 total-title">\n                                Thành tiền\n                            </div>\n                            <div class="col-xs-12 total-value">\n                                <span>{{tables.total | money}}</span>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="btn-groups">\n                        <button v-if="options.use_bartender" :class="{ \'disabled\' : !tables.alert }" class="btn btn-warning btn-big" @click.stop.prevent="_notifications()">\n                            <i class="fas fa-bell"></i>&nbsp; Báo bếp (F9)\n                        </button>\n                        <button :class="{ \'disabled\' : !tables.payment || options.loadingAddProduct }" class="btn btn-success btn-big" @click.stop.prevent="_showPayment()">\n                            <i class="fas fa-check"></i>&nbsp; Thanh toán (F10)\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    ',props:{data:{required:!0},options:{}},data:function(){return{keywordCustomer:"",loading:!1,sendIndex:0,timeout:null}},methods:{_changeCustomerSearch:function(t){return 0===t.trim().length?null:(t=(t=helper.convertCharacters(t)).toLowerCase(),new Promise(function(e){$.post("/admin/sales/pos/postFindCustomersByPhoneOrName",{keyword:t},function(t){403!=t.status&&0==t.error&&e(t.data)}).fail(function(){}).always(function(){})}))},_selectCustomerSearch:function(t){this.$set(this.data,"customer_id",t._id),this.$set(this.data,"customer",t)},_removeCustomer:function(){this.keywordCustomer="",this.data.customer_id="",this.data.customer=null},_updateNoteTable:function(t){var e=this;return new Promise(function(n,i){$.post("/admin/sales/pos/postUpdateNoteTable",{_id:e.data._id,note:t},function(i){403!=i.status&&0==i.error&&(e.data.note=t,n(!0))}).fail(function(){}).always(function(){})})},_showNote:function(){var t=this,e=!0,n=$.confirm({title:"Thêm ghi chú",content:'\n                    <form action="" class="form-note">\n                        <div class="form-group">\n                            <textarea type="text"  placeholder="Nhập ghi chú " class="name form-control" >'+t.data.note+"</textarea>\n                        </div>\n                    </form>\n                ",type:"green",backgroundDismiss:function(){return"backdrop"},closeIcon:!0,buttons:{backdrop:{isHidden:!0,action:function(){return e}},save:{text:"Xác nhận",btnClass:"btn-success",action:function(){return e=!1,n.showLoading(!0),t._updateNoteTable(this.$content.find("textarea").val())}},close:{text:"Đóng",btnClass:"btn-default"}},onContentReady:function(){var e=this;this.$content.find("textarea").focus().val("").val(t.data.note),this.$content.find("form").on("submit",function(t){t.preventDefault(),e.$$save.trigger("click")})}})},_showPayment:function(){0!=this.data.products.length&&(this.$root.payment=this.data)},_notifications:function(){var t=this;$.post("/admin/sales/pos/postUpdateProductToChief",{_id:this.data._id},function(e){403!=e.status&&(0==e.error?(t.data.products.map(function(t){return t.hasOwnProperty("processing")&&1==t.processing&&(t.chief_quantity=t.request_quantity),t}),socket.emit("pos_user_alert_to_chief",{user:t.$root.user,source:t.data.name,data:e.data})):helper.dialog(e.message,"notifications","warning",1e4))})},_onSubmitCreateCustomer:function(t){var e=this;this.$root.createCustomer(function(t){e._selectCustomerSearch(t)})}},computed:{tables:function(){var t=this,e=0,n=!1,i=!1;return void 0!=t.data&&null!=t.data&&t.data.products.length&&(i=!0,t.data.products.forEach(function(t){t.request_quantity>t.chief_quantity&&1==t.processing&&(n=!0),e+=t.request_quantity*t.price_sale})),{summary:e,total:e-t.data.discount_value,alert:n,payment:i}},name:function(){var t="";if(void 0!=this.data){t=this.data.name;var e=_.find(this.$root.groups,{_id:this.data.group_id});void 0!=e&&(t+=" - "+e.name),this.data.hasOwnProperty("relation")&&this.data.relation.length&&(t+=" ( Ghép với ",this.data.relation.forEach(function(e,n){t+=0==n?e.name:" , "+e.name}),t+=" )")}return t}},watch:{"data.products":{handler:function(t){var e=this;clearTimeout(this.timeout),this.timeout=setTimeout(function(){socket.emit("pos_user_update_table",{source:e.data})},1e3)},deep:!0}},created:function(){},mounted:function(){}}),Vue.component("item-product",{template:'\n        <div class="item-product-order detail_source_product">\n            <div class="item-product-index">\n                {{index + 1}}\n            </div>\n            <div class="item-product-action">\n                <a class="btn-item-remove" @click.stop.prevent="_remove()">\n                    <i class="material-icons text-danger">close</i>\n                </a>\n                <template v-if="item.processing && options.use_bartender">\n                    <a class="btn-item-notification" @click.stop.prevent="_notification()" :class="{ disabled : item.request_quantity <= item.chief_quantity }">\n                        <i class="material-icons text-warning">notifications</i>\n                    </a>\n                </template>\n            </div>\n            <div class="item-product-info">\n                <div class="item-product-name">\n                    <span class="item-name" :class="status">{{item.product_name}}</span>\n                </div>\n                \n                <div class="item-product-note" @click.stop.prevent="_showNote()">\n                    <a v-if=" item.note == \'\' " class="btn-note"><i class="material-icons">edit</i> Ghi chú</a>\n                    <a v-else class="btn-note"><i class="material-icons">edit</i> {{item.note}}</a>\n                </div>\n            </div>\n            <div class="item-product-quantity">\n                <div class="item-quantity-btn">\n                    <span class="btn-increase" @click.stop.prevent="_decrease()"><i class="material-icons">remove</i></span>\n                    <span class="btn-quantity" >{{item.request_quantity}}</span>\n                    <span class="btn-decrease" @click.stop.prevent="_increase()"><i class="material-icons">add</i></span>\n                </div>\n                <div class="item-quantity-info" v-if="item.chief_quantity > 0 &&  item.processing ">\n                    <span class="make-success">{{item.recive_quantity}}</span>/<span class="chief-quantity">{{item.chief_quantity}}</span>\n                </div>\n            </div>\n            <div class="item-product-price">\n                <span class="item-price">{{item.price_sale | money}}</span>\n            </div>\n            <div class="item-product-total">\n                <span class="item-total">{{item.price_sale * item.request_quantity  | money}}</span>\n            </div>\n        </div>\n    ',props:{item:{required:!0},index:{required:!0},source:{required:!0},options:{}},data:function(){return{timeout:null,loading:!1}},methods:{_increase:function(){var t=this;this.loading||this._updateQuantity(this.item.request_quantity+1,function(){t.item.request_quantity+=1,t.$root.activeItemProduct(t.item._id,!1)})},_decrease:function(){var t=this;this.loading||(this.item.request_quantity>1?this.item.request_quantity>this.item.chief_quantity?this._updateQuantity(this.item.request_quantity-1,function(){t.item.request_quantity-=1,t.$root.activeItemProduct(t.item._id,!1)}):this._showKeyboard():this._remove())},_showKeyboard:function(){var t=this;this.$root.$refs.keyboard.show("",function(e){""!=e&&e>0&&(e==t.item.request_quantity?t._remove():(t._comfirmBeforeDescrease(e),t.$root.activeItemProduct(t.item._id,!1)))},this.item.request_quantity)},_comfirmBeforeDescrease:function(t){var e=this;$.post("/admin/sales/pos/postConfirmRemoveProduct",{source_id:this.source._id,product_id:this.item.product_id,quantity:t},function(n){if(console.log(n),403!=n.status)if(0==n.error){var i=n.hasOwnProperty("message")?n.message:"";e.$root.comfirm("Thông báo !",i,{save:{text:"Xác nhận",btnClass:"btn-success",keys:["enter"],action:function(){$.post("/admin/sales/pos/postRemoveProductFromTable",{source_id:e.source._id,product_id:e.item.product_id,quantity:t},function(t){if(console.log(t),403!=t.status&&0==t.error){e.item.request_quantity=t.data.request_quantity,e.item.chief_quantity=t.data.chief_quantity;var n={user:e.$root.user,source:e.source.name,data:t.data_chief.data};e.$root.activeItemProduct(e.item._id,!1),t.hasOwnProperty("inventory")&&(e.$root.updateProductQuantity(t.inventory),n.update_product_quantity=t.inventory),socket.emit("pos_user_alert_to_chief",n)}}).fail(function(){}).always(function(){})}},close:{text:"Đóng",btnClass:"btn-default",keys:["esc"]}})}else $.dialog(n.hasOwnProperty("message")?n.message:"")}).fail(function(){}).always(function(){})},_remove:function(){var t=this;$.post("/admin/sales/pos/postConfirmRemoveProduct",{source_id:this.source._id,product_id:this.item.product_id,quantity:this.item.request_quantity},function(e){console.log(e),403!=e.status&&(0==e.error?t.$root.comfirm("Thông báo !",e.hasOwnProperty("message")?e.message:"",{save:{text:"Xác nhận",btnClass:"btn-success",keys:["enter"],action:function(){$.post("/admin/sales/pos/postUpdateQuantityProductFromTable",{source_id:t.source._id,product_id:t.item.product_id,quantity:0},function(e){if(403!=e.status&&0==e.error){t.source.products.splice(t.index,1);var n={user:t.$root.user,source:t.source.name,data:e.data_chief.data};e.hasOwnProperty("inventory")&&(t.$root.updateProductQuantity(e.inventory),n.update_product_quantity=e.inventory),socket.emit("pos_user_alert_to_chief",n)}}).fail(function(){}).always(function(){})}},close:{text:"Đóng",btnClass:"btn-default",keys:["esc"]}}):$.dialog(e.hasOwnProperty("message")?e.message:""))}).fail(function(){}).always(function(){})},_updateQuantity:function(t,e){var n=this;this.loading=!0,$.post("/admin/sales/pos/postUpdateQuantityProductFromTable",{source_id:this.source._id,product_id:this.item.product_id,quantity:t},function(t){403!=t.status&&0==t.error&&("function"==typeof e&&e(),t.hasOwnProperty("inventory")&&(n.$root.updateProductQuantity(t.inventory),socket.emit("pos_user_update_product_quantity",t.inventory)))}).fail(function(){}).always(function(){n.loading=!1})},_showNote:function(){var t=this,e=!0,n=$.confirm({title:"Thêm ghi chú",content:'\n                    <form action="" class="form-note">\n                        <div class="form-group">\n                            <textarea type="text"  placeholder="Nhập ghi chú " class="name form-control" >'+t.item.note+"</textarea>\n                        </div>\n                    </form>\n                ",closeIcon:!0,type:"green",backgroundDismiss:function(){return"backdrop"},buttons:{backdrop:{isHidden:!0,action:function(){return e}},save:{text:"Xác nhận",btnClass:"btn-success",action:function(){return e=!1,n.showLoading(!0),t._updateNote(this.$content.find("textarea").val())}},close:{text:"Đóng",btnClass:"btn-default"}},onContentReady:function(){var e=this;this.$content.find("textarea").focus().val("").val(t.item.note),this.$content.find("form").on("submit",function(t){t.preventDefault(),e.$$save.trigger("click")})}})},_updateNote:function(t){var e=this;return new Promise(function(n,i){$.post("/admin/sales/pos/postUpdateNoteProduct",{_id:e.item.product_id,source_id:e.source._id,note:t},function(i){403!=i.status&&0==i.error&&(n(!0),e.item.note=t)}).fail(function(){}).always(function(){})})},_notification:function(){var t=this;this.item.chief_quantity<this.item.request_quantity&&$.post("/admin/sales/pos/postUpdateSingleProductToChief",{_id:this.source._id,product_id:this.item.product_id},function(e){403!=e.status&&0==e.error&&(t.item.chief_quantity=t.item.request_quantity,socket.emit("pos_user_alert_to_chief",{user:t.$root.user,source:t.source.name,data:e.data}))})}},computed:{status:function(){return this.item.chief_quantity>0?this.item.recive_quantity==this.item.chief_quantity?"success":"danger":""}},watch:{}}),Vue.component("logs",{template:'\n\t\t<div class="modal fade modal-logs" >\n\t\t    <div class="modal-dialog modal-lg" role="document">\n\t\t        <div class="modal-content">\n\t\t            <div class="modal-header">\n\t\t                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n\t\t                <h4 class="modal-title">Lịch sử</h4>\n\t\t            </div>\n\t\t            <div class="modal-body">\n\t\t            \t<div class="row">\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<div class="col-xs-6 mg-bottom-10">\n\t\t\t\t\t\t\t\t<label>Bàn</label>\n\t\t\t\t\t\t\t\t<select2 class="form-control" v-model="pagination.source_id" :options="listSources"></select2>\n\t\t\t\t\t\t\t</div>\t\n\t\t\t\t\t\t\t<div class="col-xs-6 mg-bottom-10">\n\t\t\t\t\t\t\t\t<label>Nhân viên</label>\n\t\t\t\t\t\t\t\t<select2 class="form-control" v-model="pagination.user_id" :options="listUsers"></select2>\n\t\t\t\t\t\t\t</div>\t\n\t\t\t\t\t\t\t<div class="col-xs-12 mg-bottom-10">\n\t\t\t\t\t\t\t\t<label>Thời gian</label>\n\t\t\t\t\t\t\t\t<daterange-picker v-model="pagination.range"></daterange-picker>\n\t\t\t\t\t\t\t</div>\n\t\t            \t</div>\n\t\t                <div class="table table-logs">\n\t\t\t\t\t\t\t<div class="table-head">\n\t\t\t\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t\t\t\t<div class="col index">#</div>\n\t\t\t\t\t\t\t\t\t<div class="col message">Hành động</div>\n\t\t\t\t\t\t\t\t\t<div class="col source">Bàn</div>\n\t\t\t\t\t\t\t\t\t<div class="col user">Nhân viên</div>\n\t\t\t\t\t\t\t\t\t<div class="col created">Thời gian</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="table-body" >\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<template v-if="loading">\n\t\t\t\t\t\t\t\t\t\t<div class="box-loading" style="height:300px">\n                                            <svg class="circular" viewBox="25 25 50 50">\n                                                <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10" />\n                                            </svg>\n                                        </div>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t\t<template v-if="pagination.data.length">\n\t\t\t\t\t\t\t\t\t\t\t<div class="row" v-for="(item, index) in pagination.data">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="col index">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{{(pagination.limit * (pagination.page - 1)) + index + 1}}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="col message">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{{ item.message }}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="col source">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<template v-if="_.has(item , \'source.name\')">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{{item.source.name}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="col user">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<template v-if="_.has(item , \'user.name\')">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{{item.user.name}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="col created">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{{ item.created_at | full-time}}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t\t\t<div class="box-loading" style="height:300px">\n\t                                            <div class="text-center text-danger"><h3>Không tìm thấy dữ liệu</h3></div>\n\t                                        </div>\n\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t</div>\n\t\t                </div>\n\t\t            </div>\n\t\t            <div class="modal-footer">\n\t\t                <div class="row">\n                            <div class="col-xs-6 text-left">\n                                <div class="inline-block inline-limit">\n                                    <select2 :options="limits" v-model="pagination.limit"></select2>\n                                </div>\n                            </div>\n                            <div class="col-xs-6">\n                                <div class="text-right">\n                                    <pagination :total="pagination.total" :current="pagination.page" :change="_changePage"></pagination>\n                                </div>\n                            </div>\n                        </div>\n\t\t            </div>\n\t\t        </div>\n\t\t    </div>\n\t\t</div>\n\t',props:{show:{},users:{},options:{},sources:{}},data:function(){return{loading:!1,pagination:{data:[],limit:10,page:1,total:0,user_id:"",source_id:"",range:{startDate:parseInt(moment().startOf("day").valueOf()/1e3),endDate:parseInt(moment().endOf("day").valueOf()/1e3)}},limits:[{_id:10,text:10},{_id:20,text:20},{_id:50,text:50},{_id:100,text:100}],listUsers:[],listSources:[]}},methods:{_load:function(){var t=this;this.loading=!0;var e={limit:this.pagination.limit,page:this.pagination.page};"all"!=this.pagination.user_id&&(e.user_id=this.pagination.user_id),"all"!=this.pagination.source_id&&(e.source_id=this.pagination.source_id),""!=this.pagination.range.startDate&&""!=this.pagination.range.endDate&&(e.startDate=this.pagination.range.startDate,e.endDate=this.pagination.range.endDate),$.post("/admin/sales/pos/postLoadPosLogs",e,function(e){403!=e.status&&(0==e.error?(t.pagination.data=e.data,t.pagination.page=e.page,t.pagination.total=e.total):helper.dialog(e.message,"warning","warning",1e3))}).fail(function(){}).always(function(){t.loading=!1})},_changePage:function(t){this.pagination.page=t,this._load()}},watch:{"pagination.limit":function(){1!=this.pagination.page&&(this.pagination.page=1),this._load()},"pagination.user_id":function(){1!=this.pagination.page&&(this.pagination.page=1),this._load()},"pagination.source_id":function(){1!=this.pagination.page&&(this.pagination.page=1),this._load()},"pagination.range":{handler:function(){1!=this.pagination.page&&(this.pagination.page=1),this._load()},deep:!0}},created:function(){this.listSources=JSON.parse(JSON.stringify(this.sources)),this.listSources.unshift({_id:"all",text:"Tất cả"}),this.listUsers.push({_id:"all",text:"Tất cả"});for(var t in this.users)this.users.hasOwnProperty(t)&&this.listUsers.push({_id:t,text:this.users[t]})},mounted:function(){var t=this;$(this.$el).modal("show"),$(this.$el).on("hidden.bs.modal",function(){t.$emit("update:show",!1)}),this._load()}});var app=new AppTableOrders("#app");$(window).scannerDetection({timeBeforeScanTest:200,startChar:[120],endChar:[13],ignoreIfFocusOn:["input","textarea"],avgTimeByChar:40,minLength:2,onError:function(t,e){},onComplete:function(t,e){if(""!=app.config.activeTable){var n=_.find(app.products,{barcode:t});console.log(n),void 0!=n&&app.addProduct(n,1)}}});